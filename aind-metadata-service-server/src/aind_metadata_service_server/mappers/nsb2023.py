"""Module template autogenerated from SharePoint schema."""

import re
from dataclasses import dataclass
from datetime import date, datetime
from decimal import Decimal, DecimalException
from enum import Enum
from typing import Any, Dict, List, Optional, Union

from aind_data_schema.components.configs import ProbeConfig
from aind_data_schema.components.coordinates import (
    Axis,
    AxisName,
    CoordinateSystem,
    CoordinateSystemLibrary,
    Direction,
    Rotation,
    Translation,
)
from aind_data_schema.components.devices import FiberProbe
from aind_data_schema.components.injection_procedures import (
    InjectionDynamics,
    InjectionProfile,
    NonViralMaterial,
    ViralMaterial,
)
from aind_data_schema.components.subject_procedures import Anaesthetic, Surgery
from aind_data_schema.components.surgery_procedures import (
    BrainInjection,
    Craniotomy,
    CraniotomyType,
    Headframe,
    HeadframeMaterial,
    ProbeImplant,
)
from aind_data_schema_models.brain_atlas import BrainStructureModel, CCFv3
from aind_data_schema_models.coordinates import AnatomicalRelative, Origin
from aind_data_schema_models.devices import FerruleMaterial
from aind_data_schema_models.organizations import Organization
from aind_data_schema_models.units import (
    AngleUnit,
    CurrentUnit,
    SizeUnit,
    VolumeUnit,
)
from aind_sharepoint_service_async_client.models import (
    NSB2023IacucProtocol as IacucProtocol,
)
from aind_sharepoint_service_async_client.models import (
    NSB2023List,
    NSB2023Procedure,
    NSB2023ProcedureCategory,
)
from pydantic import ValidationError

from aind_metadata_service_server.models import IntendedMeasurementInformation


class BurrHoleProcedure(Enum):
    """Enum class for BurrHoleProcedure"""

    INJECTION = "Injection"
    FIBER_IMPLANT = "Fiber Implant"
    INJECTION_FIBER_IMPLANT = "Injection and Fiber Implant"
    SPINAL_INJECTION = "Spinal Injection"
    GRID_INJECTION_9 = "9 Grid Injection"
    GRID_INJECTION_6 = "6 Grid Injection"


class During(Enum):
    """Enum class for During"""

    INITIAL = "Initial Surgery"
    FOLLOW_UP = "Follow-up"


class HeadPost(Enum):
    """Enum class for HeadPost"""

    AI_HEADBAR = "AI Straight bar"
    WHC_NP = "WHC NP"
    WHC_2P = "WHC 2P"
    VISUAL_CTX = "Visual Ctx"
    FRONTAL_CTX = "Frontal Ctx"
    MOTOR_CTX = "Motor Ctx"
    WHC_FULL_RING = "WHC (Full ring)"
    WHC_NP_ZIRCONIA = "WHC NP (Zirconia)"
    L_SHAPED = "L-shaped"
    LC = "LC"
    DHC = "DHC"


class HeadPostType(Enum):
    """Enum class for HeadPostType (Well)"""

    NEUROPIXEL = "Neuropixel"
    MESOSCOPE = "Mesoscope"
    NO_WELL = "No Well"
    CAM = "Scientifica (CAM)"
    WHC_NP = "WHC NP"
    WHC_2P = "WHC 2P"
    WHC_NP_ZIRCONIA = "WHC NP (Zirconia)"
    AI_STRAIGHT_BAR_WELL = "AI Straight bar Well"
    LC_WELL = "LC well"
    DHC_WELL = "DHC well"
    MOTOR_CTX_SLAP2_WELL = "Motor Ctx SLAP2 well"
    VISUAL_CTX_SLAP2_WELL = "Visual Ctx SLAP2 well"


class InjectionType(Enum):
    """Enum class for Injection Types"""

    NANOJECT = "Nanoject"
    IONTOPHORESIS = "Iontophoresis"
    SPINAL = "Spinal"


class FiberType(Enum):
    """Enum class for Fiber Types"""

    STANDARD = "Standard"
    CUSTOM = "Custom (specs in comment)."


class BurrIntendedMeasurement(Enum):
    """Enum class for Burr Intended Measurement"""

    DOPAMINE = "dopamine"
    SEROTONIN = "serotonin"
    NOREPINEPHRINE = "norepinephrine"
    ACETYLCHOLINE = "acetylcholine"
    HISTAMINE = "histamine"
    GLUTAMATE = "glutamate"
    GABA = "GABA"
    CALCIUM = "calcium"
    VOLTAGE = "voltage"
    CONTROL = "control"


@dataclass
class SurgeryDuringInfo:
    """Container for information related to surgeries during initial or
    follow-up sessions"""

    anaesthetic_duration_in_minutes: Optional[float] = None
    anaesthetic_level: Optional[float] = None
    start_date: Optional[datetime] = None
    workstation_id: Optional[str] = None
    recovery_time: Optional[float] = None
    weight_prior: Optional[float] = None
    weight_post: Optional[float] = None


@dataclass
class InjectableMaterial:
    """Container for injectable material information"""

    material: Optional[str] = None
    titer_str: Optional[str] = None
    # concentration: Optional[str] = None


@dataclass
class BurrHoleInfo:
    """Container for burr hole information"""

    hemisphere: Optional[AnatomicalRelative] = None
    coordinate_ml: Optional[Decimal] = None
    coordinate_ap: Optional[Decimal] = None
    coordinate_depth: Optional[List[Decimal]] = None
    angle: Optional[Decimal] = None
    during: Optional[During] = None
    inj_type: Optional[InjectionType] = None
    virus_strain: Optional[str] = None
    inj_current: Optional[Decimal] = None
    alternating_current: Optional[str] = None
    inj_duration: Optional[Decimal] = None
    inj_volume: Optional[Decimal] = None
    inj_materials: Optional[List[InjectableMaterial]] = None
    fiber_implant_depth: Optional[Decimal] = None
    fiber_type: Optional[FiberType] = None
    fiber_implant_length: Optional[Decimal] = None
    intended_measurement_r: Optional[str] = None
    intended_measurement_g: Optional[str] = None
    intended_measurement_b: Optional[str] = None
    intended_measurement_iso: Optional[str] = None
    transforms: Optional[List[Union[Translation, Rotation]]] = None
    targeted_structure: Optional[BrainStructureModel] = None
    coordinate_system: Optional[CoordinateSystem] = None
    spinal_location: Optional[Origin] = None


@dataclass
class HeadPostInfo:
    """Extends HeadPostInfo data container to include extra constructor"""

    headframe_type: Optional[str] = None
    headframe_part_number: Optional[str] = None
    headframe_material: Optional[HeadframeMaterial] = None
    well_type: Optional[str] = None
    well_part_number: Optional[str] = None

    @classmethod
    def from_hp_and_hp_type(
        cls, hp: Optional[HeadPost], hp_type: Optional[HeadPostType]
    ):
        """Construct HeadPostInfo2023 from headpost and headpost_type"""
        # TODO: map part numbers for new headframe and well types
        # TODO: map headframe material
        headframe_type = None if hp is None else hp.value
        well_type = None if hp_type is None else hp_type.value
        headframe_material = None
        if hp == HeadPost.VISUAL_CTX:
            headframe_part_number = "0160-100-10"
        elif hp == HeadPost.WHC_NP:
            headframe_part_number = "0160-100-42"
        elif hp == HeadPost.WHC_2P:
            headframe_part_number = "0160-100-45"
        elif hp == HeadPost.FRONTAL_CTX:
            headframe_part_number = "0160-100-46"
        elif hp == HeadPost.MOTOR_CTX:
            headframe_part_number = "0160-100-51"
        elif hp == HeadPost.DHC:
            headframe_part_number = "0160-100-57"
            headframe_material = HeadframeMaterial.TITANIUM
        else:
            headframe_part_number = None
        if hp_type == HeadPostType.CAM:
            well_part_number = "Rev A"
        elif hp_type == HeadPostType.MESOSCOPE:
            well_part_number = "0160-200-20"
        elif hp_type == HeadPostType.NEUROPIXEL:
            well_part_number = "0160-200-36"
        elif hp_type == HeadPostType.WHC_NP:
            well_part_number = "0160-055-08"
        elif hp_type == HeadPostType.WHC_2P:
            well_part_number = "0160-200-62"
        elif hp_type == HeadPostType.DHC_WELL:
            well_part_number = "0160-075-01"
        else:
            well_part_number = None
        return cls(
            headframe_type=headframe_type,
            headframe_part_number=headframe_part_number,
            well_type=well_type,
            well_part_number=well_part_number,
            headframe_material=headframe_material,
        )


@dataclass
class IntendedMeasurementandCoords:
    """Data container used for intended measurements."""

    coordinate_ap: Optional[Decimal] = None
    coordinate_ml: Optional[Decimal] = None
    intended_measurement_R: Optional[str] = None
    intended_measurement_G: Optional[str] = None
    intended_measurement_B: Optional[str] = None
    intended_measurement_Iso: Optional[str] = None


class MappedNSBList:
    """Mapped Fields in SharePoint list."""

    ISO_DUR_REGEX1 = re.compile(r"^ *(\d*\.?\d+)\s*(?:hour|hours)* *$")
    ISO_DUR_REGEX2 = re.compile(r"^(\d+):(\d+)$")
    ALT_TIME_REGEX = re.compile(
        r"^ *(7)(?:.0|/7|s on/7s off)? *(?:s|sec|secs|second|seconds)? *$"
    )
    INJ_ANGLE_REGEX = re.compile(
        r"^ *([-+]?\d*\.?\d+) *(?:deg|degree|degrees)* *$"
    )
    CURRENT_REGEX = re.compile(r"^ *([-+]?\d*\.?\d+) *(?:ua|uA|uAmp)* *$")
    LENGTH_OF_TIME_REGEX = re.compile(
        r"^ *(\d*\.?\d+) *(?:m|min|mins|minute|minutes)+ *$"
    )
    SCIENTIFIC_NOTATION_REGEX = re.compile(
        r"^[-+]?\d*\.?\d+[eE][-+]?\d+(?![\d.])"
    )
    CONCENTRATION_REGEX = re.compile(r"^\d+(\.\d+)?\s*mg[/]m[lL]$")
    LENGTH_MM_REGEX = re.compile(r"^([1-9]\.\d) mm$")
    SPINAL_LOCATION_REGEX = re.compile(
        r"Between_([A-Z]\d+)-([A-Z]\d+)", re.IGNORECASE
    )

    def __init__(self, nsb: NSB2023List):
        """Class constructor"""
        self._nsb = nsb

    @staticmethod
    def _map_float_to_decimal(value: Optional[float]) -> Optional[Decimal]:
        """Parse string representation of float such as '0.25'."""
        if value is None:
            return None
        if float(value).is_integer():
            return Decimal(f"{int(value)}.0")
        return Decimal(str(value))

    @staticmethod
    def _parse_basic_decimal_str(value: Optional[str]) -> Optional[Decimal]:
        """Parse string representation of decimal such as '0.25'."""
        try:
            return None if value is None else Decimal(value)
        except (ValueError, DecimalException):
            return None

    def _parse_current_str(self, cur_str: Optional[str]) -> Optional[Decimal]:
        """Parse current strings"""
        if cur_str is not None:
            parsed_string = re.search(self.CURRENT_REGEX, cur_str)
            if parsed_string is not None:
                return self._parse_basic_decimal_str(parsed_string.group(1))
            else:
                return None
        else:
            return None

    def _parse_length_of_time_str(
        self, len_of_time_str: Optional[str]
    ) -> Optional[Decimal]:
        """Parse length of time strings"""
        if len_of_time_str is not None:
            parsed_string = re.search(
                self.LENGTH_OF_TIME_REGEX, len_of_time_str
            )
            if parsed_string is not None:
                return self._parse_basic_decimal_str(parsed_string.group(1))
            else:
                return None
        else:
            return None

    def _parse_fiber_length_mm_str(self, fiber_length_str: str):
        """Parses length of fiber length strings"""
        parsed_string = re.search(self.LENGTH_MM_REGEX, fiber_length_str)
        if parsed_string:
            return self._parse_basic_decimal_str(parsed_string.group(1))
        else:
            return None

    @staticmethod
    def _parse_datetime_to_date(dt: Optional[datetime]) -> Optional[date]:
        """Parse date from datetime"""
        return None if dt is None else dt.date()

    @staticmethod
    def _parse_virus_strain_str(
        virus_strain_str: Optional[str],
    ) -> Optional[str]:
        """Parse virus strain strings"""
        # TODO: Figure out how to parse virus strain field
        return virus_strain_str

    def _is_titer(self, titer_str: str) -> bool:
        """Checks whether titer field is in scientific notation."""
        return bool(re.search(self.SCIENTIFIC_NOTATION_REGEX, titer_str))

    def _is_concentration(self, titer_str: str) -> bool:
        """Checks whether titer field contains concentration."""
        return bool(re.search(self.CONCENTRATION_REGEX, titer_str))

    @staticmethod
    def _parse_titer_str(titer_str: Optional[str]) -> Optional[int]:
        """Parse string representation of titer into int."""
        return None if titer_str is None else int(float(titer_str))

    @staticmethod
    def _parse_concentration_str(
        con_str: Optional[str],
    ) -> Optional[Decimal]:
        """Parse string representation of concentration into Decimal."""
        return None if con_str is None else Decimal(str(float(con_str)))

    @staticmethod
    def _map_targeted_structure(
        structure_str: str,
    ) -> Optional[BrainStructureModel]:
        """
        Maps targeted structure from string to BrainStructureModel.
        """
        try:
            acronym = structure_str.split(" - ")[0].strip()
            return CCFv3.by_acronym(acronym)
        except (ValueError, AttributeError, IndexError):
            return None

    @property
    def aind_ap2nd_inj(self) -> Optional[Decimal]:
        """Maps ap2nd_inj to aind model."""
        return self._map_float_to_decimal(self._nsb.ap2nd_inj)

    @property
    def aind_breg2_lamb(self) -> Optional[Decimal]:
        """Maps breg2_lamb to aind model"""
        parsed = self._map_float_to_decimal(self._nsb.breg2_lamb)
        return abs(parsed) if parsed else None

    @property
    def aind_burr1_perform_during(self) -> Optional[During]:
        """Maps burr1_perform_during to aind model"""
        return (
            None
            if self._nsb.burr1_x0020_perform_x0020_during is None
            else {
                self._nsb.burr1_x0020_perform_x0020_during.INITIAL_SURGERY: (
                    During.INITIAL
                ),
                self._nsb.burr1_x0020_perform_x0020_during.FOLLOW_UP_SURGERY: (
                    During.FOLLOW_UP
                ),
            }.get(self._nsb.burr1_x0020_perform_x0020_during, None)
        )

    @property
    def aind_burr2_perform_during(self) -> Optional[During]:
        """Maps burr2_perform_during to aind model"""
        return (
            None
            if self._nsb.burr2_x0020_perform_x0020_during is None
            else {
                self._nsb.burr2_x0020_perform_x0020_during.INITIAL_SURGERY: (
                    During.INITIAL
                ),
                self._nsb.burr2_x0020_perform_x0020_during.FOLLOW_UP_SURGERY: (
                    During.FOLLOW_UP
                ),
            }.get(self._nsb.burr2_x0020_perform_x0020_during, None)
        )

    @property
    def aind_burr3_a_p(self) -> Optional[Decimal]:
        """Maps burr3_a_p to aind model"""
        return self._map_float_to_decimal(self._nsb.burr3_x0020_a_x002f_p)

    @property
    def aind_burr3_d_v(self) -> Optional[Decimal]:
        """Maps burr3_d_v to aind model"""
        return self._map_float_to_decimal(self._nsb.burr3_x0020_d_x002f_v)

    @property
    def aind_burr3_m_l(self) -> Optional[Decimal]:
        """Maps burr3_m_l to aind model"""
        return self._map_float_to_decimal(self._nsb.burr3_x0020_m_x002f_l)

    @property
    def aind_burr3_perform_during(self) -> Optional[During]:
        """Maps burr3_perform_during to aind model"""
        return (
            None
            if self._nsb.burr3_x0020_perform_x0020_during is None
            else {
                self._nsb.burr3_x0020_perform_x0020_during.INITIAL_SURGERY: (
                    During.INITIAL
                ),
                self._nsb.burr3_x0020_perform_x0020_during.FOLLOW_UP_SURGERY: (
                    During.FOLLOW_UP
                ),
            }.get(self._nsb.burr3_x0020_perform_x0020_during, None)
        )

    @property
    def aind_burr4_a_p(self) -> Optional[Decimal]:
        """Maps burr4_a_p to aind model"""
        return self._map_float_to_decimal(self._nsb.burr4_x0020_a_x002f_p)

    @property
    def aind_burr4_d_v(self) -> Optional[Decimal]:
        """Maps burr4_d_v to aind model"""
        return self._map_float_to_decimal(self._nsb.burr4_x0020_d_x002f_v)

    @property
    def aind_burr4_m_l(self) -> Optional[Decimal]:
        """Maps burr4_m_l to aind model"""
        return self._map_float_to_decimal(self._nsb.burr4_x0020_m_x002f_l)

    @property
    def aind_burr4_perform_during(self) -> Optional[During]:
        """Maps burr4_perform_during to aind model"""
        return (
            None
            if self._nsb.burr4_x0020_perform_x0020_during is None
            else {
                self._nsb.burr4_x0020_perform_x0020_during.INITIAL_SURGERY: (
                    During.INITIAL
                ),
                self._nsb.burr4_x0020_perform_x0020_during.FOLLOW_UP_SURGERY: (
                    During.FOLLOW_UP
                ),
            }.get(self._nsb.burr4_x0020_perform_x0020_during, None)
        )

    @property
    def aind_burr5_perform_during(self) -> Optional[During]:
        """Maps burr5_perform_during to aind model"""
        return (
            None
            if self._nsb.burr5_x0020_perform_x0020_during is None
            else {
                self._nsb.burr5_x0020_perform_x0020_during.INITIAL_SURGERY: (
                    During.INITIAL
                ),
                self._nsb.burr5_x0020_perform_x0020_during.FOLLOW_UP_SURGERY: (
                    During.FOLLOW_UP
                ),
            }.get(self._nsb.burr5_x0020_perform_x0020_during, None)
        )

    @property
    def aind_burr6_perform_during(self) -> Optional[During]:
        """Maps burr6_perform_during to aind model"""
        return (
            None
            if self._nsb.burr6_x0020_perform_x0020_during is None
            else {
                self._nsb.burr6_x0020_perform_x0020_during.INITIAL_SURGERY: (
                    During.INITIAL
                ),
                self._nsb.burr6_x0020_perform_x0020_during.FOLLOW_UP_SURGERY: (
                    During.FOLLOW_UP
                ),
            }.get(self._nsb.burr6_x0020_perform_x0020_during, None)
        )

    @property
    def aind_burr_1_d_v_x00(self) -> Optional[Decimal]:
        """Maps burr_1_d_v_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_1_x0020_d_x002f_v_x00
        )

    @property
    def aind_burr_1_dv_2(self) -> Optional[Decimal]:
        """Maps burr_1_dv_2 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_1_x0020_dv_x0020_2
        )

    @property
    def aind_burr_1_fiber_t(self) -> Optional[FiberType]:
        """Maps burr_1_fiber_t to aind model"""
        fiber_type = self._nsb.burr_x0020_1_x0020_fiber_x0020_t
        return (
            None
            if fiber_type is None
            else {
                fiber_type.STANDARD_PROVIDED_BY_NSB: FiberType.STANDARD,
                fiber_type.CUSTOM: FiberType.CUSTOM,
            }.get(fiber_type, None)
        )

    @property
    def aind_burr_1_injectable_x0(self) -> Optional[str]:
        """Maps burr_1_injectable_x0 to aind model."""
        # first 4 are injectable material, other 4 are titer
        return self._nsb.burr_x0020_1_x0020_injectable_x0

    @property
    def aind_burr_1_injectable_x00(self) -> Optional[str]:
        """Maps burr_1_injectable_x00 to aind model."""
        return self._nsb.burr_x0020_1_x0020_injectable_x00

    @property
    def aind_burr_1_injectable_x01(self) -> Optional[str]:
        """Maps burr_1_injectable_x01 to aind model."""
        return self._nsb.burr_x0020_1_x0020_injectable_x01

    @property
    def aind_burr_1_injectable_x02(self) -> Optional[str]:
        """Maps burr_1_injectable_x02 to aind model."""
        return self._nsb.burr_x0020_1_x0020_injectable_x02

    @property
    def aind_burr_1_injectable_x03(self) -> Optional[str]:
        """Maps burr_1_injectable_x03 to aind model."""
        return self._nsb.burr_x0020_1_x0020_injectable_x03

    @property
    def aind_burr_1_injectable_x04(self) -> Optional[str]:
        """Maps burr_1_injectable_x04 to aind model."""
        return self._nsb.burr_x0020_1_x0020_injectable_x04

    @property
    def aind_burr_1_injectable_x05(self) -> Optional[str]:
        """Maps burr_1_injectable_x05 to aind model."""
        return self._nsb.burr_x0020_1_x0020_injectable_x05

    @property
    def aind_burr_1_injectable_x06(self) -> Optional[str]:
        """Maps burr_1_injectable_x06 to aind model."""
        return self._nsb.burr_x0020_1_x0020_injectable_x06

    @property
    def aind_burr_1_intended(self) -> Optional[List[BrainStructureModel]]:
        """Maps burr_1_intended to aind model."""
        burr_1_intended = self._nsb.burr_x0020_1_x0020_intended_x002
        if burr_1_intended is None:
            return None
        else:
            return [
                self._map_targeted_structure(target)
                for target in burr_1_intended
                if self._map_targeted_structure(target) is not None
            ]

    @property
    def aind_burr_1_intended_x0020(self) -> Optional[str]:
        """Maps burr_1_intended_x0020 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_1_x0020_intended_x0020", None
        )
        return (
            None
            if intended is None
            or intended.value == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_1_intended_x0021(self) -> Optional[str]:
        """Maps burr_1_intended_x0021 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_1_x0020_intended_x0021", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_1_intended_x0022(self) -> Optional[str]:
        """Maps burr_1_intended_x0022 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_1_x0020_intended_x0022", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_1_intended_x0023(self) -> Optional[str]:
        """Maps burr_1_intended_x0023 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_1_x0020_intended_x0023", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_1_spinal_location(self) -> Optional[Origin]:
        """Maps burr_1_spinal_location to aind model."""
        spinal_location = self._nsb.burr_x0020_1_x0020_spinal_x0020_
        return (
            None
            if spinal_location is None
            else {
                spinal_location.SELECT: None,
                spinal_location.BETWEEN_C1_C2: Origin.BETWEEN_C1_C2,
                spinal_location.BETWEEN_C2_C3: Origin.BETWEEN_C2_C3,
                spinal_location.BETWEEN_C3_C4: Origin.BETWEEN_C3_C4,
                spinal_location.BETWEEN_C4_C5: Origin.BETWEEN_C4_C5,
                spinal_location.BETWEEN_C6_C7: Origin.BETWEEN_C6_C7,
                spinal_location.BETWEEN_C7_C8: Origin.BETWEEN_C7_C8,
                spinal_location.BETWEEN_C8_T1: Origin.BETWEEN_C8_T1,
                spinal_location.BETWEEN_T1_T2: Origin.BETWEEN_T1_T2,
            }.get(spinal_location, None)
        )

    @property
    def aind_burr_2_spinal_location(self) -> Optional[Origin]:
        """Maps burr_2_spinal_location to aind model"""
        spinal_location = self._nsb.burr_x0020_2_x0020_spinal_x0020_
        return (
            None
            if spinal_location is None
            else {
                spinal_location.SELECT: None,
                spinal_location.BETWEEN_C1_C2: Origin.BETWEEN_C1_C2,
                spinal_location.BETWEEN_C2_C3: Origin.BETWEEN_C2_C3,
                spinal_location.BETWEEN_C3_C4: Origin.BETWEEN_C3_C4,
                spinal_location.BETWEEN_C4_C5: Origin.BETWEEN_C4_C5,
                spinal_location.BETWEEN_C6_C7: Origin.BETWEEN_C6_C7,
                spinal_location.BETWEEN_C7_C8: Origin.BETWEEN_C7_C8,
                spinal_location.BETWEEN_C8_T1: Origin.BETWEEN_C8_T1,
                spinal_location.BETWEEN_T1_T2: Origin.BETWEEN_T1_T2,
            }.get(spinal_location, None)
        )

    @staticmethod
    def _get_spinal_coordinate_system_name(spinal_origin: Origin) -> str:
        """
        Helper method to generate coordinate system name from spinal location.

        Parameters
        ----------
        spinal_origin: Origin
            The spinal origin location (e.g., Origin.BETWEEN_C1_C2)

        Returns
        -------
        str
            The coordinate system name (e.g., "C1C2_ARID")
        """
        if spinal_origin is None:
            return "Spinal_ARID"
        origin_name = spinal_origin.value
        match = re.search(MappedNSBList.SPINAL_LOCATION_REGEX, origin_name)
        if match:
            first_vertebra = match.group(1)
            second_vertebra = match.group(2)
            return f"{first_vertebra}{second_vertebra}_ARID"

        return "Spinal_ARID"

    @property
    def aind_burr_2_d_v_x00(self) -> Optional[Decimal]:
        """Maps burr_2_d_v_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_2_x0020_d_x002f_v_x00
        )

    @property
    def aind_burr_2_d_v_x000(self) -> Optional[Decimal]:
        """Maps burr_2_d_v_x000 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_2_x0020_d_x002f_v_x000
        )

    @property
    def aind_burr_2_fiber_t(self) -> Optional[FiberType]:
        """Maps burr_2_fiber_t to aind model"""
        fiber_type = self._nsb.burr_x0020_2_x0020_fiber_x0020_t
        return (
            None
            if fiber_type is None
            else {
                fiber_type.STANDARD_PROVIDED_BY_NSB: FiberType.STANDARD,
                fiber_type.CUSTOM: FiberType.CUSTOM,
            }.get(fiber_type, None)
        )

    @property
    def aind_burr_2_injectable_x0(self) -> Optional[str]:
        """Maps burr_2_injectable_x0 to aind model."""
        return self._nsb.burr_x0020_2_x0020_injectable_x0

    @property
    def aind_burr_2_injectable_x00(self) -> Optional[str]:
        """Maps burr_2_injectable_x00 to aind model."""
        return self._nsb.burr_x0020_2_x0020_injectable_x00

    @property
    def aind_burr_2_injectable_x01(self) -> Optional[str]:
        """Maps burr_2_injectable_x01 to aind model."""
        return self._nsb.burr_x0020_2_x0020_injectable_x01

    @property
    def aind_burr_2_injectable_x02(self) -> Optional[str]:
        """Maps burr_2_injectable_x02 to aind model."""
        return self._nsb.burr_x0020_2_x0020_injectable_x02

    @property
    def aind_burr_2_injectable_x03(self) -> Optional[str]:
        """Maps burr_2_injectable_x03 to aind model."""
        return self._nsb.burr_x0020_2_x0020_injectable_x03

    @property
    def aind_burr_2_injectable_x04(self) -> Optional[str]:
        """Maps burr_2_injectable_x04 to aind model."""
        return self._nsb.burr_x0020_2_x0020_injectable_x04

    @property
    def aind_burr_2_injectable_x05(self) -> Optional[str]:
        """Maps burr_2_injectable_x05 to aind model."""
        return self._nsb.burr_x0020_2_x0020_injectable_x05

    @property
    def aind_burr_2_injectable_x06(self) -> Optional[str]:
        """Maps burr_2_injectable_x06 to aind model."""
        return self._nsb.burr_x0020_2_x0020_injectable_x06

    @property
    def aind_burr_2_intended(self) -> Optional[List[BrainStructureModel]]:
        """Maps burr_2_intended to aind model."""
        burr_2_intended = self._nsb.burr_x0020_2_x0020_intended_x002
        if burr_2_intended is None:
            return None
        else:
            return [
                self._map_targeted_structure(target)
                for target in burr_2_intended
                if self._map_targeted_structure(target) is not None
            ]

    @property
    def aind_burr_2_intended_x0020(self) -> Optional[str]:
        """Maps burr_2_intended_x0020 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_2_x0020_intended_x0020", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_2_intended_x0021(self) -> Optional[str]:
        """Maps burr_2_intended_x0021 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_2_x0020_intended_x0021", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_2_intended_x0022(self) -> Optional[str]:
        """Maps burr_2_intended_x0022 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_2_x0020_intended_x0022", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_2_intended_x0023(self) -> Optional[str]:
        """Maps burr_2_intended_x0023 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_2_x0020_intended_x0023", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_3_angle(self) -> Optional[Decimal]:
        """Maps burr_3_angle to aind model"""
        return self._map_float_to_decimal(self._nsb.burr_x0020_3_x0020_angle)

    @property
    def aind_burr_3_d_v_x00(self) -> Optional[Decimal]:
        """Maps burr_3_d_v_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_3_x0020_d_x002f_v_x00
        )

    @property
    def aind_burr_3_d_v_x000(self) -> Optional[Decimal]:
        """Maps burr_3_d_v_x000 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_3_x0020_d_x002f_v_x000
        )

    @property
    def aind_burr_3_fiber_t(self) -> Optional[FiberType]:
        """Maps burr_3_fiber_t to aind model"""
        fiber_type = self._nsb.burr_x0020_3_x0020_fiber_x0020_t
        return (
            None
            if fiber_type is None
            else {
                fiber_type.STANDARD_PROVIDED_BY_NSB: FiberType.STANDARD,
                fiber_type.CUSTOM: FiberType.CUSTOM,
            }.get(fiber_type, None)
        )

    @property
    def aind_burr_3_hemisphere(self) -> Optional[AnatomicalRelative]:
        """Maps burr_3_hemisphere to aind model"""
        return (
            None
            if self._nsb.burr_x0020_3_x0020_hemisphere is None
            else {
                self._nsb.burr_x0020_3_x0020_hemisphere.SELECT: None,
                self._nsb.burr_x0020_3_x0020_hemisphere.LEFT: (
                    AnatomicalRelative.LEFT
                ),
                self._nsb.burr_x0020_3_x0020_hemisphere.RIGHT: (
                    AnatomicalRelative.RIGHT
                ),
            }.get(self._nsb.burr_x0020_3_x0020_hemisphere, None)
        )

    @property
    def aind_burr_3_injectable_x0(self) -> Optional[str]:
        """Maps burr_3_injectable_x0 to aind model."""
        return self._nsb.burr_x0020_3_x0020_injectable_x0

    @property
    def aind_burr_3_injectable_x00(self) -> Optional[str]:
        """Maps burr_3_injectable_x00 to aind model."""
        return self._nsb.burr_x0020_3_x0020_injectable_x00

    @property
    def aind_burr_3_injectable_x01(self) -> Optional[str]:
        """Maps burr_3_injectable_x01 to aind model."""
        return self._nsb.burr_x0020_3_x0020_injectable_x01

    @property
    def aind_burr_3_injectable_x02(self) -> Optional[str]:
        """Maps burr_3_injectable_x02 to aind model."""
        return self._nsb.burr_x0020_3_x0020_injectable_x02

    @property
    def aind_burr_3_injectable_x03(self) -> Optional[str]:
        """Maps burr_3_injectable_x03 to aind model."""
        return self._nsb.burr_x0020_3_x0020_injectable_x03

    @property
    def aind_burr_3_injectable_x04(self) -> Optional[str]:
        """Maps burr_3_injectable_x04 to aind model."""
        return self._nsb.burr_x0020_3_x0020_injectable_x04

    @property
    def aind_burr_3_injectable_x05(self) -> Optional[str]:
        """Maps burr_3_injectable_x05 to aind model."""
        return self._nsb.burr_x0020_3_x0020_injectable_x05

    @property
    def aind_burr_3_injectable_x06(self) -> Optional[str]:
        """Maps burr_3_injectable_x06 to aind model."""
        return self._nsb.burr_x0020_3_x0020_injectable_x06

    @property
    def aind_burr_3_intended(self) -> Optional[List[BrainStructureModel]]:
        """Maps burr_3_intended to aind model."""
        burr_3_intended = self._nsb.burr_x0020_3_x0020_intended_x002
        if burr_3_intended is None:
            return None
        else:
            return [
                self._map_targeted_structure(target)
                for target in burr_3_intended
                if self._map_targeted_structure(target) is not None
            ]

    @property
    def aind_burr_3_intended_x0020(self) -> Optional[str]:
        """Maps burr_3_intended_x0020 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_3_x0020_intended_x0020", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_3_intended_x0021(self) -> Optional[str]:
        """Maps burr_3_intended_x0021 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_3_x0020_intended_x0021", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_3_intended_x0022(self) -> Optional[Any]:
        """Maps burr_3_intended_x0022 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_3_x0020_intended_x0022", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_3_intended_x0023(self) -> Optional[str]:
        """Maps burr_3_intended_x0023 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_3_x0020_intended_x0023", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_4_angle(self) -> Optional[Decimal]:
        """Maps burr_4_angle to aind model"""
        return self._map_float_to_decimal(self._nsb.burr_x0020_4_x0020_angle)

    @property
    def aind_burr_4_d_v_x00(self) -> Optional[Decimal]:
        """Maps burr_4_d_v_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_4_x0020_d_x002f_v_x00
        )

    @property
    def aind_burr_4_d_v_x000(self) -> Optional[Decimal]:
        """Maps burr_4_d_v_x000 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_4_x0020_d_x002f_v_x000
        )

    @property
    def aind_burr_4_fiber_t(self) -> Optional[FiberType]:
        """Maps burr_4_fiber_t to aind model"""
        fiber_type = self._nsb.burr_x0020_4_x0020_fiber_x0020_t
        return (
            None
            if fiber_type is None
            else {
                fiber_type.STANDARD_PROVIDED_BY_NSB: FiberType.STANDARD,
                fiber_type.CUSTOM: FiberType.CUSTOM,
            }.get(fiber_type, None)
        )

    @property
    def aind_burr_4_hemisphere(self) -> Optional[AnatomicalRelative]:
        """Maps burr_4_hemisphere to aind model"""
        return (
            None
            if self._nsb.burr_x0020_4_x0020_hemisphere is None
            else {
                self._nsb.burr_x0020_4_x0020_hemisphere.SELECT: None,
                self._nsb.burr_x0020_4_x0020_hemisphere.LEFT: (
                    AnatomicalRelative.LEFT,
                ),
                self._nsb.burr_x0020_4_x0020_hemisphere.RIGHT: (
                    AnatomicalRelative.RIGHT
                ),
            }.get(self._nsb.burr_x0020_4_x0020_hemisphere, None)
        )

    @property
    def aind_burr_4_injectable_x0(self) -> Optional[str]:
        """Maps burr_4_injectable_x0 to aind model."""
        return self._nsb.burr_x0020_4_x0020_injectable_x0

    @property
    def aind_burr_4_injectable_x00(self) -> Optional[str]:
        """Maps burr_4_injectable_x00 to aind model."""
        return self._nsb.burr_x0020_4_x0020_injectable_x00

    @property
    def aind_burr_4_injectable_x01(self) -> Optional[str]:
        """Maps burr_4_injectable_x01 to aind model."""
        return self._nsb.burr_x0020_4_x0020_injectable_x01

    @property
    def aind_burr_4_injectable_x02(self) -> Optional[str]:
        """Maps burr_4_injectable_x02 to aind model."""
        return self._nsb.burr_x0020_4_x0020_injectable_x02

    @property
    def aind_burr_4_injectable_x03(self) -> Optional[str]:
        """Maps burr_4_injectable_x03 to aind model."""
        return self._nsb.burr_x0020_4_x0020_injectable_x03

    @property
    def aind_burr_4_injectable_x04(self) -> Optional[str]:
        """Maps burr_4_injectable_x04 to aind model."""
        return self._nsb.burr_x0020_4_x0020_injectable_x04

    @property
    def aind_burr_4_injectable_x05(self) -> Optional[str]:
        """Maps burr_4_injectable_x05 to aind model."""
        return self._nsb.burr_x0020_4_x0020_injectable_x05

    @property
    def aind_burr_4_injectable_x06(self) -> Optional[str]:
        """Maps burr_4_injectable_x06 to aind model."""
        return self._nsb.burr_x0020_4_x0020_injectable_x06

    @property
    def aind_burr_4_intended(self) -> Optional[List[BrainStructureModel]]:
        """Maps burr_4_intended to aind model."""
        burr_4_intended = self._nsb.burr_x0020_4_x0020_intended_x002
        if burr_4_intended is None:
            return None
        else:
            return [
                self._map_targeted_structure(target)
                for target in burr_4_intended
                if self._map_targeted_structure(target) is not None
            ]

    @property
    def aind_burr_4_intended_x0020(self) -> Optional[str]:
        """Maps burr_4_intended_x0020 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_4_x0020_intended_x0020", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_4_intended_x0021(self) -> Optional[str]:
        """Maps burr_4_intended_x0021 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_4_x0020_intended_x0021", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_4_intended_x0022(self) -> Optional[str]:
        """Maps burr_4_intended_x0022 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_4_x0020_intended_x0022", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_4_intended_x0023(self) -> Optional[str]:
        """Maps burr_4_intended_x0023 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_4_x0020_intended_x0023", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_5_a_p(self) -> Optional[Decimal]:
        """Maps burr_5_a_p to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_5_x0020_a_x002f_p
        )

    @property
    def aind_burr_5_angle(self) -> Optional[Decimal]:
        """Maps burr_5_angle to aind model"""
        return self._map_float_to_decimal(self._nsb.burr_x0020_5_x0020_angle)

    @property
    def aind_burr_5_d_v_x00(self) -> Optional[Decimal]:
        """Maps burr_5_d_v_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_5_x0020_d_x002f_v_x00
        )

    @property
    def aind_burr_5_d_v_x000(self) -> Optional[Decimal]:
        """Maps burr_5_d_v_x000 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_5_x0020_d_x002f_v_x000
        )

    @property
    def aind_burr_5_d_v_x001(self) -> Optional[Decimal]:
        """Maps burr_5_d_v_x001 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_5_x0020_d_x002f_v_x001
        )

    @property
    def aind_burr_5_fiber_t(self) -> Optional[Any]:
        """Maps burr_5_fiber_t to aind model"""
        fiber_type = self._nsb.burr_x0020_5_x0020_fiber_x0020_t
        return (
            None
            if fiber_type is None
            else {
                fiber_type.STANDARD_PROVIDED_BY_NSB: FiberType.STANDARD,
                fiber_type.CUSTOM: FiberType.CUSTOM,
            }.get(fiber_type, None)
        )

    @property
    def aind_burr_5_hemisphere(self) -> Optional[AnatomicalRelative]:
        """Maps burr_5_hemisphere to aind model"""
        return (
            None
            if self._nsb.burr_x0020_5_x0020_hemisphere is None
            else {
                self._nsb.burr_x0020_5_x0020_hemisphere.SELECT: None,
                self._nsb.burr_x0020_5_x0020_hemisphere.LEFT: (
                    AnatomicalRelative.LEFT
                ),
                self._nsb.burr_x0020_5_x0020_hemisphere.RIGHT: (
                    AnatomicalRelative.RIGHT
                ),
            }.get(self._nsb.burr_x0020_5_x0020_hemisphere, None)
        )

    @property
    def aind_burr_5_injectable_x0(self) -> Optional[str]:
        """Maps burr_5_injectable_x0 to aind model."""
        return self._nsb.burr_x0020_5_x0020_injectable_x0

    @property
    def aind_burr_5_injectable_x00(self) -> Optional[str]:
        """Maps burr_5_injectable_x00 to aind model."""
        return self._nsb.burr_x0020_5_x0020_injectable_x00

    @property
    def aind_burr_5_injectable_x01(self) -> Optional[str]:
        """Maps burr_5_injectable_x01 to aind model."""
        return self._nsb.burr_x0020_5_x0020_injectable_x01

    @property
    def aind_burr_5_injectable_x02(self) -> Optional[str]:
        """Maps burr_5_injectable_x02 to aind model."""
        return self._nsb.burr_x0020_5_x0020_injectable_x02

    @property
    def aind_burr_5_injectable_x03(self) -> Optional[str]:
        """Maps burr_5_injectable_x03 to aind model."""
        return self._nsb.burr_x0020_5_x0020_injectable_x03

    @property
    def aind_burr_5_injectable_x04(self) -> Optional[str]:
        """Maps burr_5_injectable_x04 to aind model."""
        return self._nsb.burr_x0020_5_x0020_injectable_x04

    @property
    def aind_burr_5_injectable_x05(self) -> Optional[str]:
        """Maps burr_5_injectable_x05 to aind model."""
        return self._nsb.burr_x0020_5_x0020_injectable_x05

    @property
    def aind_burr_5_injectable_x06(self) -> Optional[str]:
        """Maps burr_5_injectable_x06 to aind model."""
        return self._nsb.burr_x0020_5_x0020_injectable_x06

    @property
    def aind_burr_5_intended(self) -> Optional[List[BrainStructureModel]]:
        """Maps burr_5_intended to aind model."""
        burr_5_intended = self._nsb.burr_x0020_5_x0020_intended_x002
        if burr_5_intended is None:
            return None
        else:
            return [
                self._map_targeted_structure(target)
                for target in burr_5_intended
                if self._map_targeted_structure(target) is not None
            ]

    @property
    def aind_burr_5_intended_x0020(self) -> Optional[str]:
        """Maps burr_5_intended_x0020 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_5_x0020_intended_x0020", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_5_intended_x0021(self) -> Optional[str]:
        """Maps burr_5_intended_x0021 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_5_x0020_intended_x0021", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_5_intended_x0022(self) -> Optional[str]:
        """Maps burr_5_intended_x0022 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_5_x0020_intended_x0022", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_5_intended_x0023(self) -> Optional[str]:
        """Maps burr_5_intended_x0023 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_5_x0020_intended_x0023", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_5_m_l(self) -> Optional[Decimal]:
        """Maps burr_5_m_l to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_5_x0020_m_x002f_l
        )

    @property
    def aind_burr_6_a_p(self) -> Optional[Decimal]:
        """Maps burr_6_a_p to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_6_x0020_a_x002f_p
        )

    @property
    def aind_burr_6_angle(self) -> Optional[Decimal]:
        """Maps burr_6_angle to aind model"""
        return self._map_float_to_decimal(self._nsb.burr_x0020_6_x0020_angle)

    @property
    def aind_burr_6_d_v_x00(self) -> Optional[Decimal]:
        """Maps burr_6_d_v_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_6_x0020_d_x002f_v_x00
        )

    @property
    def aind_burr_6_d_v_x000(self) -> Optional[Decimal]:
        """Maps burr_6_d_v_x000 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_6_x0020_d_x002f_v_x000
        )

    @property
    def aind_burr_6_d_v_x001(self) -> Optional[Decimal]:
        """Maps burr_6_d_v_x001 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_6_x0020_d_x002f_v_x001
        )

    @property
    def aind_burr_6_fiber_t(self) -> Optional[FiberType]:
        """Maps burr_6_fiber_t to aind model"""
        fiber_type = self._nsb.burr_x0020_6_x0020_fiber_x0020_t
        return (
            None
            if fiber_type is None
            else {
                fiber_type.STANDARD_PROVIDED_BY_NSB: (FiberType.STANDARD),
                fiber_type.CUSTOM: (FiberType.CUSTOM),
            }.get(fiber_type, None)
        )

    @property
    def aind_burr_6_hemisphere(self) -> Optional[AnatomicalRelative]:
        """Maps burr_6_hemisphere to aind model"""
        return (
            None
            if self._nsb.burr_x0020_6_x0020_hemisphere is None
            else {
                self._nsb.burr_x0020_6_x0020_hemisphere.SELECT: None,
                self._nsb.burr_x0020_6_x0020_hemisphere.LEFT: (
                    AnatomicalRelative.LEFT
                ),
                self._nsb.burr_x0020_6_x0020_hemisphere.RIGHT: (
                    AnatomicalRelative.RIGHT
                ),
            }.get(self._nsb.burr_x0020_6_x0020_hemisphere, None)
        )

    @property
    def aind_burr_6_injectable_x0(self) -> Optional[str]:
        """Maps burr_6_injectable_x0 to aind model."""
        return self._nsb.burr_x0020_6_x0020_injectable_x0

    @property
    def aind_burr_6_injectable_x00(self) -> Optional[str]:
        """Maps burr_6_injectable_x00 to aind model."""
        return self._nsb.burr_x0020_6_x0020_injectable_x00

    @property
    def aind_burr_6_injectable_x01(self) -> Optional[str]:
        """Maps burr_6_injectable_x01 to aind model."""
        return self._nsb.burr_x0020_6_x0020_injectable_x01

    @property
    def aind_burr_6_injectable_x02(self) -> Optional[str]:
        """Maps burr_6_injectable_x02 to aind model."""
        return self._nsb.burr_x0020_6_x0020_injectable_x02

    @property
    def aind_burr_6_injectable_x03(self) -> Optional[str]:
        """Maps burr_6_injectable_x03 to aind model."""
        return self._nsb.burr_x0020_6_x0020_injectable_x03

    @property
    def aind_burr_6_injectable_x04(self) -> Optional[str]:
        """Maps burr_6_injectable_x04 to aind model."""
        return self._nsb.burr_x0020_6_x0020_injectable_x04

    @property
    def aind_burr_6_injectable_x05(self) -> Optional[str]:
        """Maps burr_6_injectable_x05 to aind model."""
        return self._nsb.burr_x0020_6_x0020_injectable_x05

    @property
    def aind_burr_6_injectable_x06(self) -> Optional[str]:
        """Maps burr_6_injectable_x06 to aind model."""
        return self._nsb.burr_x0020_6_x0020_injectable_x06

    @property
    def aind_burr_6_intended(self) -> Optional[List[BrainStructureModel]]:
        """Maps burr_6_intended to aind model."""
        burr_6_intended = self._nsb.burr_x0020_6_x0020_intended_x002
        if burr_6_intended is None:
            return None
        else:
            return [
                self._map_targeted_structure(target)
                for target in burr_6_intended
                if self._map_targeted_structure(target) is not None
            ]

    @property
    def aind_burr_6_intended_x0020(self) -> Optional[str]:
        """Maps burr_6_intended_x0020 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_6_x0020_intended_x0020", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_6_intended_x0021(self) -> Optional[str]:
        """Maps burr_6_intended_x0021 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_6_x0020_intended_x0021", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_6_intended_x0022(self) -> Optional[str]:
        """Maps burr_6_intended_x0022 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_6_x0020_intended_x0022", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_6_intended_x0023(self) -> Optional[str]:
        """Maps burr_6_intended_x0023 to aind model."""
        intended = getattr(
            self._nsb, "burr_x0020_6_x0020_intended_x0023", None
        )
        return (
            None
            if intended is None or intended == getattr(intended, "N_A", None)
            else intended.value
        )

    @property
    def aind_burr_6_m_l(self) -> Optional[Decimal]:
        """Maps burr_6_m_l to aind model"""
        return self._map_float_to_decimal(
            self._nsb.burr_x0020_6_x0020_m_x002f_l
        )

    @property
    def aind_burr_hole_1(self) -> Optional[BurrHoleProcedure]:
        """Maps burr_hole_1 to aind model."""
        return (
            None
            if self._nsb.burr_x0020_hole_x0020_1 is None
            else {
                self._nsb.burr_x0020_hole_x0020_1.SELECT: None,
                self._nsb.burr_x0020_hole_x0020_1.STEREOTAXIC_INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_1.SPINAL_INJECTION: (
                    BurrHoleProcedure.SPINAL_INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_1.N_9_GRID_INJECTION: (
                    BurrHoleProcedure.GRID_INJECTION_9
                ),
                self._nsb.burr_x0020_hole_x0020_1.N_6_GRID_INJECTION: (
                    BurrHoleProcedure.GRID_INJECTION_6
                ),
                self._nsb.burr_x0020_hole_x0020_1.FIBER_IMPLANT: (
                    BurrHoleProcedure.FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_1.STEREOTAXIC_INJECTION_F: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_1.INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_1.INJECTION_FIBER_IMPLANT: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
            }.get(self._nsb.burr_x0020_hole_x0020_1, None)
        )

    @property
    def aind_burr_hole_2(self) -> Optional[BurrHoleProcedure]:
        """Maps burr_hole_2 to aind model."""
        return (
            None
            if self._nsb.burr_x0020_hole_x0020_2 is None
            else {
                self._nsb.burr_x0020_hole_x0020_2.SELECT: None,
                self._nsb.burr_x0020_hole_x0020_2.STEREOTAXIC_INJECTION: (
                    BurrHoleProcedure.INJECTION,
                ),
                self._nsb.burr_x0020_hole_x0020_2.SPINAL_INJECTION: (
                    BurrHoleProcedure.SPINAL_INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_2.FIBER_IMPLANT: (
                    BurrHoleProcedure.FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_2.STEREOTAXIC_INJECTION__F: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_2.INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_2.INJECTION_FIBER_IMPLANT: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
            }.get(self._nsb.burr_x0020_hole_x0020_2, None)
        )

    @property
    def aind_burr_hole_3(self) -> Optional[BurrHoleProcedure]:
        """Maps burr_hole_3 to aind model."""
        return (
            None
            if self._nsb.burr_x0020_hole_x0020_3 is None
            else {
                self._nsb.burr_x0020_hole_x0020_3.SELECT: None,
                self._nsb.burr_x0020_hole_x0020_3.STEREOTAXIC_INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_3.FIBER_IMPLANT: (
                    BurrHoleProcedure.FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_3.STEREOTAXIC_INJECTION__F: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_3.INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_3.INJECTION_FIBER_IMPLANT: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
            }.get(self._nsb.burr_x0020_hole_x0020_3, None)
        )

    @property
    def aind_burr_hole_4(self) -> Optional[BurrHoleProcedure]:
        """Maps burr_hole_4 to aind model."""
        return (
            None
            if self._nsb.burr_x0020_hole_x0020_4 is None
            else {
                self._nsb.burr_x0020_hole_x0020_4.SELECT: None,
                self._nsb.burr_x0020_hole_x0020_4.STEREOTAXIC_INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_4.FIBER_IMPLANT: (
                    BurrHoleProcedure.FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_4.STEREOTAXIC_INJECTION__F: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_4.INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_4.INJECTION_FIBER_IMPLANT: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
            }.get(self._nsb.burr_x0020_hole_x0020_4, None)
        )

    @property
    def aind_burr_hole_5(self) -> Optional[BurrHoleProcedure]:
        """Maps burr_hole_5 to aind model."""
        return (
            None
            if self._nsb.burr_x0020_hole_x0020_5 is None
            else {
                self._nsb.burr_x0020_hole_x0020_5.SELECT: None,
                self._nsb.burr_x0020_hole_x0020_5.STEREOTAXIC_INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_5.FIBER_IMPLANT: (
                    BurrHoleProcedure.FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_5.STEREOTAXIC_INJECTION__F: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_5.INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_5.INJECTION_FIBER_IMPLANT: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
            }.get(self._nsb.burr_x0020_hole_x0020_5, None)
        )

    @property
    def aind_burr_hole_6(self) -> Optional[BurrHoleProcedure]:
        """Maps burr_hole_6 to aind model."""
        return (
            None
            if self._nsb.burr_x0020_hole_x0020_6 is None
            else {
                self._nsb.burr_x0020_hole_x0020_6.SELECT: None,
                self._nsb.burr_x0020_hole_x0020_6.STEREOTAXIC_INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_6.FIBER_IMPLANT: (
                    BurrHoleProcedure.FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_6.STEREOTAXIC_INJECTION__F: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
                self._nsb.burr_x0020_hole_x0020_6.INJECTION: (
                    BurrHoleProcedure.INJECTION
                ),
                self._nsb.burr_x0020_hole_x0020_6.INJECTION_FIBER_IMPLANT: (
                    BurrHoleProcedure.INJECTION_FIBER_IMPLANT
                ),
            }.get(self._nsb.burr_x0020_hole_x0020_6, None)
        )

    @property
    def aind_craniotomy_perform_d(self) -> Optional[During]:
        """Maps craniotomy_perform_d to aind model"""
        craniotomy_during = self._nsb.craniotomy_x0020_perform_x0020_d
        return (
            None
            if craniotomy_during is None
            else {
                craniotomy_during.INITIAL_SURGERY: During.INITIAL,
                craniotomy_during.FOLLOW_UP_SURGERY: During.FOLLOW_UP,
            }.get(craniotomy_during, None)
        )

    @property
    def aind_craniotomy_type(self) -> Optional[CraniotomyType]:
        """Maps craniotomy_type to aind model"""
        return (
            None
            if self._nsb.craniotomy_type is None
            else {
                self._nsb.craniotomy_type.SELECT: None,
                self._nsb.craniotomy_type.N_3MM: CraniotomyType.CIRCLE,
                self._nsb.craniotomy_type.N_5MM: CraniotomyType.CIRCLE,
                self._nsb.craniotomy_type.WHC_2_P: CraniotomyType.WHC,
                self._nsb.craniotomy_type.WHC_NP: CraniotomyType.WHC,
                self._nsb.craniotomy_type.DHC: CraniotomyType.DHC,
            }.get(self._nsb.craniotomy_type, None)
        )

    @property
    def aind_date1st_injection(self) -> Optional[date]:
        """Maps date1st_injection to aind model"""
        return self._parse_datetime_to_date(self._nsb.date1st_injection)

    @property
    def aind_date_of_surgery(self) -> Optional[date]:
        """Maps date_of_surgery to aind model"""
        return self._parse_datetime_to_date(
            self._nsb.date_x0020_of_x0020_surgery
        )

    @property
    def aind_dv2nd_inj(self) -> Optional[Decimal]:
        """Maps dv2nd_inj to aind model"""
        return self._map_float_to_decimal(self._nsb.dv2nd_inj)

    @property
    def aind_fiber_implant1_dv(self) -> Optional[Decimal]:
        """Maps fiber_implant1_dv to aind model"""
        return self._map_float_to_decimal(self._nsb.fiber_implant1_dv)

    @property
    def aind_fiber_implant1_lengt(self) -> Optional[Decimal]:
        """Maps fiber_implant1_lengt to aind model"""
        return (
            None
            if self._nsb.fiber_x0020_implant1_x0020_lengt is None
            else self._parse_fiber_length_mm_str(
                self._nsb.fiber_x0020_implant1_x0020_lengt.value
            )
        )

    @property
    def aind_fiber_implant2_dv(self) -> Optional[Decimal]:
        """Maps fiber_implant2_dv to aind model"""
        return self._map_float_to_decimal(self._nsb.fiber_implant2_dv)

    @property
    def aind_fiber_implant2_lengt(self) -> Optional[Decimal]:
        """Maps fiber_implant2_lengt to aind model"""
        return (
            None
            if self._nsb.fiber_x0020_implant2_x0020_lengt is None
            else self._parse_fiber_length_mm_str(
                self._nsb.fiber_x0020_implant2_x0020_lengt.value
            )
        )

    @property
    def aind_fiber_implant3_d_x00(self) -> Optional[Decimal]:
        """Maps fiber_implant3_d_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.fiber_x0020_implant3_x0020_d_x00
        )

    @property
    def aind_fiber_implant3_lengt(self) -> Optional[Decimal]:
        """Maps fiber_implant3_lengt to aind model"""
        return (
            None
            if self._nsb.fiber_x0020_implant3_x0020_lengt is None
            else self._parse_fiber_length_mm_str(
                self._nsb.fiber_x0020_implant3_x0020_lengt.value
            )
        )

    @property
    def aind_fiber_implant4_d_x00(self) -> Optional[Decimal]:
        """Maps fiber_implant4_d_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.fiber_x0020_implant4_x0020_d_x00
        )

    @property
    def aind_fiber_implant4_lengt(self) -> Optional[Decimal]:
        """Maps fiber_implant4_lengt to aind model"""
        return (
            None
            if self._nsb.fiber_x0020_implant4_x0020_lengt is None
            else self._parse_fiber_length_mm_str(
                self._nsb.fiber_x0020_implant4_x0020_lengt.value
            )
        )

    @property
    def aind_fiber_implant5_d_x00(self) -> Optional[Decimal]:
        """Maps fiber_implant5_d_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.fiber_x0020_implant5_x0020_d_x00
        )

    @property
    def aind_fiber_implant5_lengt(self) -> Optional[Decimal]:
        """Maps fiber_implant5_lengt to aind model"""
        return (
            None
            if self._nsb.fiber_x0020_implant5_x0020_lengt is None
            else self._parse_fiber_length_mm_str(
                self._nsb.fiber_x0020_implant5_x0020_lengt.value
            )
        )

    @property
    def aind_fiber_implant6_d_x00(self) -> Optional[Decimal]:
        """Maps fiber_implant6_d_x00 to aind model"""
        return self._map_float_to_decimal(
            self._nsb.fiber_x0020_implant6_x0020_d_x00
        )

    @property
    def aind_fiber_implant6_lengt(self) -> Optional[Decimal]:
        """Maps fiber_implant6_lengt to aind model"""
        return (
            None
            if self._nsb.fiber_x0020_implant6_x0020_lengt is None
            else self._parse_fiber_length_mm_str(
                self._nsb.fiber_x0020_implant6_x0020_lengt.value
            )
        )

    @property
    def aind_first_inj_recovery(self) -> Optional[Decimal]:
        """Maps first_inj_recovery to aind model"""
        return self._map_float_to_decimal(self._nsb.first_inj_recovery)

    @property
    def aind_first_injection_iso_durat(self) -> Optional[float]:
        """Maps first_injection_iso_durat to aind model"""
        optional_decimal = self._map_float_to_decimal(
            self._nsb.first_injection_iso_duration
        )
        return (
            None if optional_decimal is None else float(optional_decimal * 60)
        )

    @property
    def aind_first_injection_weight_af(self) -> Optional[Decimal]:
        """Maps first_injection_weight_af to aind model"""
        return self._map_float_to_decimal(
            self._nsb.first_injection_weight_after
        )

    @property
    def aind_first_injection_weight_be(self) -> Optional[Decimal]:
        """Maps first_injection_weight_be to aind model"""
        return self._map_float_to_decimal(
            self._nsb.first_injection_weight_befor
        )

    @property
    def aind_headpost(self) -> Optional[HeadPost]:
        """Maps headpost to aind model."""
        return (
            None
            if self._nsb.headpost is None
            else {
                self._nsb.headpost.SELECT: None,
                self._nsb.headpost.AI_STRAIGHT_BAR: HeadPost.AI_HEADBAR,
                self._nsb.headpost.FRONTAL_CTX: HeadPost.FRONTAL_CTX,
                self._nsb.headpost.LSHAPED: HeadPost.L_SHAPED,
                self._nsb.headpost.MOTOR_CTX: HeadPost.MOTOR_CTX,
                self._nsb.headpost.VISUAL_CTX: HeadPost.VISUAL_CTX,
                self._nsb.headpost.WHC_FULL_RING: HeadPost.WHC_FULL_RING,
                self._nsb.headpost.WHC_NP_ZIRCONIA: HeadPost.WHC_NP_ZIRCONIA,
                self._nsb.headpost.WHC_NP: HeadPost.WHC_NP,
                self._nsb.headpost.WHC_2P: HeadPost.WHC_2P,
                self._nsb.headpost.LC: HeadPost.LC,
                self._nsb.headpost.DHC: HeadPost.DHC,
                self._nsb.headpost.OTHER_ADD_DETAILS_IN_REQU: None,
            }.get(self._nsb.headpost, None)
        )

    @property
    def aind_headpost_perform_dur(self) -> Optional[During]:
        """Maps headpost_perform_dur to aind model"""
        headpost_during = self._nsb.headpost_x0020_perform_x0020_dur
        return (
            None
            if headpost_during is None
            else {
                headpost_during.INITIAL_SURGERY: During.INITIAL,
                headpost_during.FOLLOW_UP_SURGERY: During.FOLLOW_UP,
            }.get(headpost_during, None)
        )

    @property
    def aind_headpost_type(self) -> Optional[HeadPostType]:
        """Maps headpost_type to aind model."""
        # TODO: Add new headpost types and handle mappings
        hp_type = self._nsb.headpost_type
        return (
            None
            if hp_type is None
            else {
                hp_type.SELECT: None,
                hp_type.NO_WELL: HeadPostType.NO_WELL,
                hp_type.SCIENTIFICA_CAM: HeadPostType.CAM,
                hp_type.MESOSCOPE: HeadPostType.MESOSCOPE,
                hp_type.NEUROPIXEL: HeadPostType.NEUROPIXEL,
                hp_type.WHC_2_P: HeadPostType.WHC_2P,
                hp_type.WHC_NP: HeadPostType.WHC_NP,
                hp_type.WHC_NP_ZIRCONIA: HeadPostType.WHC_NP_ZIRCONIA,
                hp_type.AI_STRAIGHT_BAR_WELL: (
                    HeadPostType.AI_STRAIGHT_BAR_WELL
                ),
                hp_type.LC_WELL: HeadPostType.LC_WELL,
                hp_type.DHC_WELL: HeadPostType.DHC_WELL,
                hp_type.MOTOR__CTX_SLAP2_WELL: (
                    HeadPostType.MOTOR_CTX_SLAP2_WELL
                ),
                hp_type.VISUAL__CTX_SLAP2_WELL: (
                    HeadPostType.VISUAL_CTX_SLAP2_WELL
                ),
                hp_type.OTHER_SEE_REQUESTOR_COMM: None,
            }.get(hp_type, None)
        )

    @property
    def aind_hemisphere2nd_inj(self) -> Optional[AnatomicalRelative]:
        """Maps hemisphere2nd_inj to aind model"""
        return (
            None
            if self._nsb.hemisphere2nd_inj is None
            else {
                self._nsb.hemisphere2nd_inj.SELECT: None,
                self._nsb.hemisphere2nd_inj.LEFT: AnatomicalRelative.LEFT,
                self._nsb.hemisphere2nd_inj.RIGHT: AnatomicalRelative.RIGHT,
            }.get(self._nsb.hemisphere2nd_inj, None)
        )

    @property
    def aind_hp_iso_level(self) -> Optional[Decimal]:
        """Maps hp_iso_level to aind model"""
        return self._map_float_to_decimal(self._nsb.hp_iso_level)

    @property
    def aind_hp_recovery(self) -> Optional[Decimal]:
        """Maps hp_recovery to aind model"""
        return self._map_float_to_decimal(self._nsb.hp_recovery)

    @property
    def aind_hp_work_station(self) -> Optional[str]:
        """Maps hp_work_station to aind model"""
        return (
            None
            if self._nsb.hp_work_station is None
            or self._nsb.hp_work_station == self._nsb.hp_work_station.SELECT
            else self._nsb.hp_work_station.value
        )

    @property
    def aind_iacuc_protocol(self) -> Optional[Any]:
        """Maps iacuc_protocol to aind model."""
        return (
            None
            if self._nsb.iacuc_x0020_protocol_x0020__x002 is None
            or self._nsb.iacuc_x0020_protocol_x0020__x002
            == self._nsb.iacuc_x0020_protocol_x0020__x002.SELECT
            else self._nsb.iacuc_x0020_protocol_x0020__x002.value
        )

    @property
    def aind_implant_id_coverslip_type(self) -> Optional[Any]:
        """Maps implant_id_coverslip_type to aind model"""
        return (
            None
            if self._nsb.implant_id_coverslip_type is None
            or self._nsb.implant_id_coverslip_type
            == self._nsb.implant_id_coverslip_type.SELECT
            else self._nsb.implant_id_coverslip_type
        )

    @property
    def aind_inj1_alternating_time(self) -> Optional[str]:
        """Maps inj1_alternating_time to aind model."""
        return self._nsb.inj1_alternating_time

    @property
    def aind_inj1_angle_v2(self) -> Optional[Decimal]:
        """Maps inj1_angle_v2 to aind model"""
        return self._map_float_to_decimal(self._nsb.inj1_angle_v2)

    @property
    def aind_inj1_current(self) -> Optional[Decimal]:
        """Maps inj1_current to aind model"""
        return self._parse_current_str(self._nsb.inj1_current)

    @property
    def aind_inj1_ionto_time(self) -> Optional[Decimal]:
        """Maps inj1_ionto_time to aind model"""
        return self._parse_length_of_time_str(self._nsb.inj1_ionto_time)

    @property
    def aind_inj1_type(self) -> Optional[InjectionType]:
        """Maps inj1_type to aind model"""
        return (
            None
            if self._nsb.inj1_type is None
            else {
                self._nsb.inj1_type.SELECT: None,
                self._nsb.inj1_type.IONTOPHORESIS: InjectionType.IONTOPHORESIS,
                self._nsb.inj1_type.NANOJECT_PRESSURE: InjectionType.NANOJECT,
            }.get(self._nsb.inj1_type, None)
        )

    @property
    def aind_inj1_virus_strain_rt(self) -> Optional[str]:
        """Maps inj1_virus_strain_rt to aind model"""
        return self._parse_virus_strain_str(self._nsb.inj1_virus_strain_rt)

    @property
    def aind_inj1volperdepth(self) -> Optional[Decimal]:
        """Maps inj1volperdepth to aind model"""
        return self._map_float_to_decimal(self._nsb.inj1volperdepth)

    @property
    def aind_inj2_alternating_time(self) -> Optional[str]:
        """Maps inj2_alternating_time to aind model."""
        return self._nsb.inj2_alternating_time

    @property
    def aind_inj2_angle_v2(self) -> Optional[Decimal]:
        """Maps inj2_angle_v2 to aind model"""
        return self._map_float_to_decimal(self._nsb.inj2_angle_v2)

    @property
    def aind_inj2_current(self) -> Optional[Decimal]:
        """Maps inj2_current to aind model"""
        return self._parse_current_str(self._nsb.inj2_current)

    @property
    def aind_inj2_ionto_time(self) -> Optional[float]:
        """Maps inj2_ionto_time to aind model"""
        return self._parse_length_of_time_str(self._nsb.inj2_ionto_time)

    @property
    def aind_inj2_type(self) -> Optional[InjectionType]:
        """Maps inj2_type to aind model"""
        return (
            None
            if self._nsb.inj2_type is None
            else {
                self._nsb.inj2_type.SELECT: None,
                self._nsb.inj2_type.IONTOPHORESIS: InjectionType.IONTOPHORESIS,
                self._nsb.inj2_type.NANOJECT_PRESSURE: InjectionType.NANOJECT,
            }.get(self._nsb.inj2_type, None)
        )

    @property
    def aind_inj2_virus_strain_rt(self) -> Optional[str]:
        """Maps inj2_virus_strain_rt to aind model"""
        return self._parse_virus_strain_str(self._nsb.inj2_virus_strain_rt)

    @property
    def aind_inj2volperdepth(self) -> Optional[Decimal]:
        """Maps inj2volperdepth to aind model"""
        return self._map_float_to_decimal(self._nsb.inj2volperdepth)

    @property
    def aind_inj3_alternating_time(self) -> Optional[str]:
        """Maps inj3_alternating_time to aind model"""
        return self._nsb.inj3_alternating_time

    @property
    def aind_inj3_current(self) -> Optional[Decimal]:
        """Maps inj3_current to aind model"""
        return self._parse_current_str(self._nsb.inj3_current)

    @property
    def aind_inj3_ionto_time(self) -> Optional[Decimal]:
        """Maps inj3_ionto_time to aind model"""
        return self._parse_length_of_time_str(self._nsb.inj3_ionto_time)

    @property
    def aind_inj3_type(self) -> Optional[InjectionType]:
        """Maps inj3_type to aind model"""
        return (
            None
            if self._nsb.inj3_type is None
            else {
                self._nsb.inj3_type.SELECT: None,
                self._nsb.inj3_type.IONTOPHORESIS: InjectionType.IONTOPHORESIS,
                self._nsb.inj3_type.NANOJECT_PRESSURE: InjectionType.NANOJECT,
            }.get(self._nsb.inj3_type, None)
        )

    @property
    def aind_inj3volperdepth(self) -> Optional[Decimal]:
        """Maps inj3volperdepth to aind model"""
        return self._map_float_to_decimal(self._nsb.inj3volperdepth)

    @property
    def aind_inj4_alternating_time(self) -> Optional[str]:
        """Maps inj4_alternating_time to aind model"""
        return self._nsb.inj4_alternating_time

    @property
    def aind_inj4_current(self) -> Optional[Decimal]:
        """Maps inj4_current to aind model"""
        return self._parse_current_str(self._nsb.inj4_current)

    @property
    def aind_inj4_ionto_time(self) -> Optional[Decimal]:
        """Maps inj4_ionto_time to aind model"""
        return self._parse_length_of_time_str(self._nsb.inj4_ionto_time)

    @property
    def aind_inj4_type(self) -> Optional[InjectionType]:
        """Maps inj4_type to aind model"""
        return (
            None
            if self._nsb.inj4_type is None
            else {
                self._nsb.inj4_type.SELECT: None,
                self._nsb.inj4_type.IONTOPHORESIS: InjectionType.IONTOPHORESIS,
                self._nsb.inj4_type.NANOJECT_PRESSURE: InjectionType.NANOJECT,
            }.get(self._nsb.inj4_type, None)
        )

    @property
    def aind_inj4_virus_strain_rt(self) -> Optional[str]:
        """Maps inj4_virus_strain_rt to aind model"""
        return self._parse_virus_strain_str(self._nsb.inj4_virus_strain_rt)

    @property
    def aind_inj4volperdepth(self) -> Optional[Decimal]:
        """Maps inj4volperdepth to aind model"""
        return self._map_float_to_decimal(self._nsb.inj4volperdepth)

    @property
    def aind_inj5_alternating_time(self) -> Optional[str]:
        """Maps inj5_alternating_time to aind model"""
        return self._nsb.inj5_alternating_time

    @property
    def aind_inj5_current(self) -> Optional[Decimal]:
        """Maps inj5_current to aind model"""
        return self._parse_current_str(self._nsb.inj5_current)

    @property
    def aind_inj5_ionto_time(self) -> Optional[Decimal]:
        """Maps inj5_ionto_time to aind model"""
        return self._parse_length_of_time_str(self._nsb.inj5_ionto_time)

    @property
    def aind_inj5_type(self) -> Optional[InjectionType]:
        """Maps inj5_type to aind model"""
        return (
            None
            if self._nsb.inj5_type is None
            else {
                self._nsb.inj5_type.SELECT: None,
                self._nsb.inj5_type.IONTOPHORESIS: InjectionType.IONTOPHORESIS,
                self._nsb.inj5_type.NANOJECT_PRESSURE: InjectionType.NANOJECT,
            }.get(self._nsb.inj5_type, None)
        )

    @property
    def aind_inj5_virus_strain_rt(self) -> Optional[str]:
        """Maps inj5_virus_strain_rt to aind model"""
        return self._parse_virus_strain_str(self._nsb.inj5_virus_strain_rt)

    @property
    def aind_inj5volperdepth(self) -> Optional[Decimal]:
        """Maps inj5volperdepth to aind model"""
        return self._map_float_to_decimal(self._nsb.inj5volperdepth)

    @property
    def aind_inj6_alternating_time(self) -> Optional[str]:
        """Maps inj6_alternating_time to aind model."""
        return self._nsb.inj6_alternating_time

    @property
    def aind_inj6_current(self) -> Optional[Decimal]:
        """Maps inj6_current to aind model"""
        return self._parse_current_str(self._nsb.inj6_current)

    @property
    def aind_inj6_ionto_time(self) -> Optional[Decimal]:
        """Maps inj6_ionto_time to aind model"""
        return self._parse_length_of_time_str(self._nsb.inj6_ionto_time)

    @property
    def aind_inj6_type(self) -> Optional[InjectionType]:
        """Maps inj6_type to aind model"""
        return (
            None
            if self._nsb.inj6_type is None
            else {
                self._nsb.inj6_type.SELECT: None,
                self._nsb.inj6_type.IONTOPHORESIS: InjectionType.IONTOPHORESIS,
                self._nsb.inj6_type.NANOJECT_PRESSURE: InjectionType.NANOJECT,
            }.get(self._nsb.inj6_type, None)
        )

    @property
    def aind_inj6_virus_strain_rt(self) -> Optional[str]:
        """Maps inj6_virus_strain_rt to aind model"""
        return self._parse_virus_strain_str(self._nsb.inj6_virus_strain_rt)

    @property
    def aind_inj6volperdepth(self) -> Optional[Decimal]:
        """Maps inj6volperdepth to aind model"""
        return self._map_float_to_decimal(self._nsb.inj6volperdepth)

    @property
    def aind_inj_virus_strain_rt(self) -> Optional[str]:
        """Maps inj_virus_strain_rt to aind model"""
        return self._parse_virus_strain_str(self._nsb.inj_virus_strain_rt)

    @property
    def aind_iso_on(self) -> Optional[Decimal]:
        """Maps iso_on to aind model"""
        optional_decimal = self._map_float_to_decimal(self._nsb.iso_x0020_on)
        return None if optional_decimal is None else optional_decimal * 60

    @property
    def aind_long_requestor_comments(self) -> Optional[str]:
        """Maps long_requestor_comments to aind model."""
        return self._nsb.long_requestor_comments

    @property
    def aind_ml2nd_inj(self) -> Optional[Decimal]:
        """Maps ml2nd_inj to aind model"""
        return self._map_float_to_decimal(self._nsb.ml2nd_inj)

    @property
    def aind_procedure(self) -> Optional[NSB2023Procedure]:
        """Maps procedure to aind model"""
        return self._nsb.procedure

    @property
    def aind_protocol(self) -> Optional[str]:
        """Maps protocol to aind iacuc protocol."""
        protocol = self._nsb.protocol
        return (
            None
            if protocol is None
            else {
                protocol.SELECT: None,
                protocol.N_2119__TRAINING_AND_QUAL: IacucProtocol.N_2119.value,
                protocol.N_2201__INTERROGATING_PRO: IacucProtocol.N_2201.value,
                protocol.N_2202__TESTING_AA_VS_IN: IacucProtocol.N_2202.value,
                protocol.N_2204__PRIMARY_NEURON_AN: IacucProtocol.N_2204.value,
                protocol.N_2205__OPTIMIZATION_AND: IacucProtocol.N_2205.value,
                protocol.N_2207__IN__VITRO__BRAIN: IacucProtocol.N_2207.value,
                protocol.N_2212__INVESTIGATING__BR: IacucProtocol.N_2212.value,
                protocol.N_2301__TESTING_OF_ENHANC: IacucProtocol.N_2301.value,
                protocol.N_2304__NEUROSURGERY__BEH: IacucProtocol.N_2304.value,
                protocol.N_2305__IN__VIVO__BRAIN: IacucProtocol.N_2305.value,
                protocol.N_2306__PATCH_SEQ_CHARACT: IacucProtocol.N_2306.value,
                protocol.N_2307__DISSECTING_THE_NE: IacucProtocol.N_2307.value,
                protocol.N_2308__INDUCTION_OF__IMM: IacucProtocol.N_2308.value,
                protocol.N_2401__THE_USE_OF_MICE_F: IacucProtocol.N_2401.value,
                protocol.N_2402__BRAIN__OBSERVATOR: IacucProtocol.N_2402.value,
                protocol.N_2403__ELECTROPHYSIOLOGY: IacucProtocol.N_2403.value,
                protocol.N_2405__ANALYSIS_OF__INTE: IacucProtocol.N_2405.value,
                protocol.N_2406__CHARACTERIZATION: IacucProtocol.N_2406.value,
                protocol.N_2410__VALIDATION_OF_BRA: IacucProtocol.N_2410.value,
                protocol.N_2412__CIRCUIT_TRACING_A: IacucProtocol.N_2412.value,
                protocol.N_2413__NEUROPHYSIOLOGY_O: IacucProtocol.N_2413.value,
                protocol.N_2414__ELECTROPHYSIOLOGI: IacucProtocol.N_2414.value,
                protocol.N_2415__OPTOPHYSIOLOGICAL: IacucProtocol.N_2415.value,
                protocol.N_2416__ANATOMICAL_ANALYS: IacucProtocol.N_2416.value,
                protocol.N_2417__CHARACTERIZATION: IacucProtocol.N_2417.value,
                protocol.N_2418__IN__VITRO__SINGLE: IacucProtocol.N_2418.value,
                protocol.N_2427__OPEN_SCOPE__MINDS: IacucProtocol.N_2427.value,
            }.get(self._nsb.protocol, None)
        )

    @property
    def aind_round1_inj_isolevel(self) -> Optional[Decimal]:
        """Maps round1_inj_isolevel to aind model"""
        return self._map_float_to_decimal(self._nsb.round1_inj_isolevel)

    @property
    def aind_initial_surgeon_lookup_id(self) -> Optional[int]:
        """Maps test1_lookup_id to aind model."""
        return self._nsb.test1_lookup_id

    @property
    def aind_followup_surgeon_lookup_id(self) -> Optional[int]:
        """Maps followup_surgeon_lookup_id to aind model."""
        return self._nsb.test_x0020_1st_x0020_round_x0020_lookup_id

    @property
    def aind_virus_a_p(self) -> Optional[Decimal]:
        """Maps virus_a_p to aind model"""
        return self._map_float_to_decimal(self._nsb.virus_x0020_a_x002f_p)

    @property
    def aind_virus_d_v(self) -> Optional[Decimal]:
        """Maps virus_d_v to aind model"""
        return self._map_float_to_decimal(self._nsb.virus_x0020_d_x002f_v)

    @property
    def aind_virus_hemisphere(self) -> Optional[AnatomicalRelative]:
        """Maps virus_hemisphere to aind model"""
        return (
            None
            if self._nsb.virus_x0020_hemisphere is None
            else {
                self._nsb.virus_x0020_hemisphere.SELECT: None,
                self._nsb.virus_x0020_hemisphere.LEFT: AnatomicalRelative.LEFT,
                self._nsb.virus_x0020_hemisphere.RIGHT: (
                    AnatomicalRelative.RIGHT
                ),
            }.get(self._nsb.virus_x0020_hemisphere, None)
        )

    @property
    def aind_virus_m_l(self) -> Optional[Decimal]:
        """Maps virus_m_l to aind model"""
        return self._map_float_to_decimal(self._nsb.virus_x0020_m_x002f_l)

    @property
    def aind_weight_after_surgery(self) -> Optional[Decimal]:
        """Maps weight_after_surgery to aind model"""
        return self._map_float_to_decimal(
            self._nsb.weight_x0020_after_x0020_surgery
        )

    @property
    def aind_weight_before_surger(self) -> Optional[Decimal]:
        """Maps weight_before_surger to aind model"""
        return self._map_float_to_decimal(
            self._nsb.weight_x0020_before_x0020_surger
        )

    @property
    def aind_work_station1st_injection(self) -> Optional[Any]:
        """Maps work_station1st_injection to aind model."""
        return (
            None
            if self._nsb.work_station1st_injection is None
            or self._nsb.work_station1st_injection
            == self._nsb.work_station1st_injection.SELECT
            else self._nsb.work_station1st_injection.value
        )

    # Additional Properties
    @staticmethod
    def aind_experimenter_full_name(surgeon_id: Optional[str]) -> str:
        """Map surgeon to experimenter name"""
        return "NSB" if surgeon_id is None else f"NSB-{surgeon_id}"

    @property
    def aind_craniotomy_coordinates_reference(
        self,
    ) -> Optional[CoordinateSystem]:
        """Map craniotomy type to Origin"""
        # TODO: need to handle frontal window 3mm
        if (
            self._nsb.craniotomy_type is not None
            and self._nsb.craniotomy_type == self._nsb.craniotomy_type.N_5MM
        ):
            return CoordinateSystem(
                name="LAMBDA_ARI",
                origin=Origin.LAMBDA,
                axis_unit=SizeUnit.MM,
                axes=[
                    Axis(name=AxisName.AP, direction=Direction.PA),
                    Axis(name=AxisName.ML, direction=Direction.LR),
                    Axis(name=AxisName.SI, direction=Direction.SI),
                ],
            )
        else:
            return None

    @property
    def aind_craniotomy_size(self) -> Optional[float]:
        """Map craniotomy type to size in mm"""
        if (
            self._nsb.craniotomy_type
            and self._nsb.craniotomy_type == self._nsb.craniotomy_type.N_5MM
        ):
            return 5.0
        elif (
            self._nsb.craniotomy_type
            and self._nsb.craniotomy_type == self._nsb.craniotomy_type.N_3MM
        ):
            return 3.0
        else:
            return None

    @property
    def aind_craniotomy_coordinates(self) -> Optional[Translation]:
        """Map craniotomy type to position in mm"""
        if (
            self._nsb.craniotomy_type
            and self._nsb.craniotomy_type == self._nsb.craniotomy_type.N_5MM
        ):
            return Translation(translation=[1.3, -2.8, 0])
        else:
            return None

    # TODO: support new Procedures
    # (EMG Array, Grid Injections, Testes, Oviduct)
    def has_hp_procedure(self) -> bool:
        """Is there a headpost procedure?"""
        return self.aind_procedure in {
            NSB2023Procedure.HP_ONLY,
            NSB2023Procedure.HP_TRANSCRANIAL,
            NSB2023Procedure.FIBER_OPTIC_IMPLANT_WITH,
            NSB2023Procedure.INJECTION_FIBER_OPTIC_IMP,
            NSB2023Procedure.ISIGUIDED_INJECTION_WITH,
            NSB2023Procedure.STEREOTAXIC_INJECTION_WIT,
            # Adding new names for supported HPs
            NSB2023Procedure.SX_11_19_HP__ONLY,
            NSB2023Procedure.SX_11_19_HP__TRANSCRANIAL,
            NSB2023Procedure.SX_21__INJECTION__FIBER,
            NSB2023Procedure.SX_26_ISI_GUIDED__INJECTI,
            NSB2023Procedure.SX_12__STEREOTAXIC__INJEC,
            NSB2023Procedure.SX_21__FIBER__OPTIC__IMPL,
            NSB2023Procedure.INJECTION_FIBER_OPTIC_IMP_,
        }

    def has_cran_procedure(self) -> bool:
        """Is there a craniotomy procedure?"""
        return self.aind_procedure in {
            NSB2023Procedure.FRONTAL_CTX_2_P,
            NSB2023Procedure.INJ_MOTOR_CTX,
            NSB2023Procedure.INJ_VISUAL_CTX_2_P,
            NSB2023Procedure.INJ_WHC_NP_1_INJECTION_LO,
            NSB2023Procedure.MOTOR_CTX,
            NSB2023Procedure.VISUAL_CTX_NP,
            NSB2023Procedure.VISUAL_CTX_2_P,
            NSB2023Procedure.WHC_NP,
            # Adding new names for supported Craniotomies
            NSB2023Procedure.SX_1__VISUAL__CTX_2_P,
            NSB2023Procedure.SX_2__FRONTAL__CTX_2_P,
            NSB2023Procedure.SX_3__MOTOR__CTX_2_P,
            NSB2023Procedure.SX_4_WHC_2_P,
            NSB2023Procedure.SX_5_INJ__VISUAL__CTX_2_P,
            NSB2023Procedure.SX_6__GRID_INJ_6_OR_9__VI,
            NSB2023Procedure.SX_8_INJ__MOTOR__CTX_2_P,
            NSB2023Procedure.SX_9__GRID_INJ_6_OR_9__MO,
            NSB2023Procedure.SX_14__VISUAL__CTX_NP,
            NSB2023Procedure.SX_15_WHC_NP,
            NSB2023Procedure.SX_16_INJ_WHC_NP,
            NSB2023Procedure.GRID_INJ_6_OR_9_VISUAL,
            NSB2023Procedure.MOTOR_CTX_2_P,
            NSB2023Procedure.INJ_MOTOR_CTX_2_P,
            NSB2023Procedure.GRID_INJ_6_OR_9_MOTOR_C,
            NSB2023Procedure.INJ_WHC_NP,
            NSB2023Procedure.DHC,
        }

    def surgery_during_info(self, during: During) -> SurgeryDuringInfo:
        """
        Compiles burr hole information from NSB data
        Parameters
        ----------
        during : During
          Initial or Follow up
        inj_type : Optional[InjectionType]
          Injection type during the surgery. Default is None.

        Returns
        -------
        SurgeryDuringInfo

        """
        if during == During.FOLLOW_UP:
            # backend fields titled "1st injection" correlate with followup
            return SurgeryDuringInfo(
                anaesthetic_duration_in_minutes=(
                    self.aind_first_injection_iso_durat
                ),
                anaesthetic_level=self.aind_round1_inj_isolevel,
                start_date=self.aind_date1st_injection,
                workstation_id=self.aind_work_station1st_injection,
                recovery_time=self.aind_first_inj_recovery,
                weight_prior=self.aind_first_injection_weight_be,
                weight_post=self.aind_first_injection_weight_af,
            )
        elif during == During.INITIAL:
            # backend fields titled "HP" correlate with initial procedures
            return SurgeryDuringInfo(
                anaesthetic_duration_in_minutes=self.aind_iso_on,
                anaesthetic_level=self.aind_hp_iso_level,
                start_date=self.aind_date_of_surgery,
                workstation_id=self.aind_hp_work_station,
                recovery_time=self.aind_hp_recovery,
                weight_prior=self.aind_weight_before_surger,
                weight_post=self.aind_weight_after_surgery,
            )
        else:
            return SurgeryDuringInfo()

    def burr_hole_info(self, burr_hole_num: int) -> BurrHoleInfo:
        """
        Compiles burr hole information from NSB data
        Parameters
        ----------
        burr_hole_num : int
          Burr hole number

        Returns
        -------
        BurrHoleInfo

        """
        if burr_hole_num == 1:
            coordinate_depth = self._map_burr_hole_dv(
                self.aind_virus_d_v,
                self.aind_burr_1_d_v_x00,
                self.aind_burr_1_dv_2,
            )
            injectable_materials = self._pair_burr_hole_inj_materials(
                materials=[
                    self.aind_burr_1_injectable_x0,
                    self.aind_burr_1_injectable_x00,
                    self.aind_burr_1_injectable_x01,
                    self.aind_burr_1_injectable_x02,
                ],
                titers=[
                    self.aind_burr_1_injectable_x03,
                    self.aind_burr_1_injectable_x04,
                    self.aind_burr_1_injectable_x05,
                    self.aind_burr_1_injectable_x06,
                ],
            )
            coordinate_system = (
                CoordinateSystemLibrary.BREGMA_ARID
                if coordinate_depth
                else CoordinateSystemLibrary.BREGMA_ARI
            )
            return BurrHoleInfo(
                hemisphere=self.aind_virus_hemisphere,
                coordinate_ml=self.aind_virus_m_l,
                coordinate_ap=self.aind_virus_a_p,
                coordinate_depth=coordinate_depth,
                angle=self.aind_inj1_angle_v2,
                during=self.aind_burr1_perform_during,
                inj_type=self.aind_inj1_type,
                virus_strain=self.aind_inj1_virus_strain_rt,
                inj_current=self.aind_inj1_current,
                alternating_current=self.aind_inj1_alternating_time,
                inj_duration=self.aind_inj1_ionto_time,
                inj_volume=self.aind_inj1volperdepth,
                inj_materials=injectable_materials,
                fiber_implant_depth=self.aind_fiber_implant1_dv,
                fiber_type=self.aind_burr_1_fiber_t,
                fiber_implant_length=self.aind_fiber_implant1_lengt,
                intended_measurement_r=self.aind_burr_1_intended_x0020,
                intended_measurement_g=self.aind_burr_1_intended_x0021,
                intended_measurement_b=self.aind_burr_1_intended_x0022,
                intended_measurement_iso=self.aind_burr_1_intended_x0023,
                targeted_structure=self.aind_burr_1_intended,
                coordinate_system=coordinate_system,
                spinal_location=self.aind_burr_1_spinal_location,
            )
        elif burr_hole_num == 2:
            coordinate_depth = self._map_burr_hole_dv(
                self.aind_dv2nd_inj,
                self.aind_burr_2_d_v_x00,
                self.aind_burr_2_d_v_x000,
            )
            injectable_materials = self._pair_burr_hole_inj_materials(
                materials=[
                    self.aind_burr_2_injectable_x0,
                    self.aind_burr_2_injectable_x00,
                    self.aind_burr_2_injectable_x01,
                    self.aind_burr_2_injectable_x02,
                ],
                titers=[
                    self.aind_burr_2_injectable_x03,
                    self.aind_burr_2_injectable_x04,
                    self.aind_burr_2_injectable_x05,
                    self.aind_burr_2_injectable_x06,
                ],
            )
            coordinate_system = (
                CoordinateSystemLibrary.BREGMA_ARID
                if coordinate_depth
                else CoordinateSystemLibrary.BREGMA_ARI
            )
            return BurrHoleInfo(
                hemisphere=self.aind_hemisphere2nd_inj,
                coordinate_ml=self.aind_ml2nd_inj,
                coordinate_ap=self.aind_ap2nd_inj,
                coordinate_depth=coordinate_depth,
                angle=self.aind_inj2_angle_v2,
                during=self.aind_burr2_perform_during,
                inj_type=self.aind_inj2_type,
                virus_strain=self.aind_inj2_virus_strain_rt,
                inj_current=self.aind_inj2_current,
                alternating_current=self.aind_inj2_alternating_time,
                inj_duration=self.aind_inj2_ionto_time,
                inj_volume=self.aind_inj2volperdepth,
                inj_materials=injectable_materials,
                fiber_implant_depth=self.aind_fiber_implant2_dv,
                fiber_type=self.aind_burr_2_fiber_t,
                fiber_implant_length=self.aind_fiber_implant2_lengt,
                intended_measurement_r=self.aind_burr_2_intended_x0020,
                intended_measurement_g=self.aind_burr_2_intended_x0021,
                intended_measurement_b=self.aind_burr_2_intended_x0022,
                intended_measurement_iso=self.aind_burr_2_intended_x0023,
                targeted_structure=self.aind_burr_2_intended,
                coordinate_system=coordinate_system,
                spinal_location=self.aind_burr_2_spinal_location,
            )
        elif burr_hole_num == 3:
            coordinate_depth = self._map_burr_hole_dv(
                self.aind_burr3_d_v,
                self.aind_burr_3_d_v_x00,
                self.aind_burr_3_d_v_x000,
            )
            injectable_materials = self._pair_burr_hole_inj_materials(
                materials=[
                    self.aind_burr_3_injectable_x0,
                    self.aind_burr_3_injectable_x00,
                    self.aind_burr_3_injectable_x01,
                    self.aind_burr_3_injectable_x02,
                ],
                titers=[
                    self.aind_burr_3_injectable_x03,
                    self.aind_burr_3_injectable_x04,
                    self.aind_burr_3_injectable_x05,
                    self.aind_burr_3_injectable_x06,
                ],
            )
            coordinate_system = (
                CoordinateSystemLibrary.BREGMA_ARID
                if coordinate_depth
                else CoordinateSystemLibrary.BREGMA_ARI
            )
            return BurrHoleInfo(
                hemisphere=self.aind_burr_3_hemisphere,
                coordinate_ml=self.aind_burr3_m_l,
                coordinate_ap=self.aind_burr3_a_p,
                coordinate_depth=coordinate_depth,
                angle=self.aind_burr_3_angle,
                during=self.aind_burr3_perform_during,
                inj_type=self.aind_inj3_type,
                virus_strain=self.aind_inj_virus_strain_rt,
                inj_current=self.aind_inj3_current,
                alternating_current=self.aind_inj3_alternating_time,
                inj_duration=self.aind_inj3_ionto_time,
                inj_volume=self.aind_inj3volperdepth,
                inj_materials=injectable_materials,
                fiber_implant_depth=self.aind_fiber_implant3_d_x00,
                fiber_type=self.aind_burr_3_fiber_t,
                fiber_implant_length=self.aind_fiber_implant3_lengt,
                intended_measurement_r=self.aind_burr_3_intended_x0020,
                intended_measurement_g=self.aind_burr_3_intended_x0021,
                intended_measurement_b=self.aind_burr_3_intended_x0022,
                intended_measurement_iso=self.aind_burr_3_intended_x0023,
                targeted_structure=self.aind_burr_3_intended,
                coordinate_system=coordinate_system,
            )
        elif burr_hole_num == 4:
            coordinate_depth = self._map_burr_hole_dv(
                self.aind_burr4_d_v,
                self.aind_burr_4_d_v_x00,
                self.aind_burr_4_d_v_x000,
            )
            injectable_materials = self._pair_burr_hole_inj_materials(
                materials=[
                    self.aind_burr_4_injectable_x0,
                    self.aind_burr_4_injectable_x00,
                    self.aind_burr_4_injectable_x01,
                    self.aind_burr_4_injectable_x02,
                ],
                titers=[
                    self.aind_burr_4_injectable_x03,
                    self.aind_burr_4_injectable_x04,
                    self.aind_burr_4_injectable_x05,
                    self.aind_burr_4_injectable_x06,
                ],
            )
            coordinate_system = (
                CoordinateSystemLibrary.BREGMA_ARID
                if coordinate_depth
                else CoordinateSystemLibrary.BREGMA_ARI
            )
            return BurrHoleInfo(
                hemisphere=self.aind_burr_4_hemisphere,
                coordinate_ml=self.aind_burr4_m_l,
                coordinate_ap=self.aind_burr4_a_p,
                coordinate_depth=coordinate_depth,
                angle=self.aind_burr_4_angle,
                during=self.aind_burr4_perform_during,
                inj_type=self.aind_inj4_type,
                virus_strain=self.aind_inj4_virus_strain_rt,
                inj_current=self.aind_inj4_current,
                alternating_current=self.aind_inj4_alternating_time,
                inj_duration=self.aind_inj4_ionto_time,
                inj_volume=self.aind_inj4volperdepth,
                inj_materials=injectable_materials,
                fiber_implant_depth=self.aind_fiber_implant4_d_x00,
                fiber_type=self.aind_burr_4_fiber_t,
                fiber_implant_length=self.aind_fiber_implant4_lengt,
                intended_measurement_r=self.aind_burr_4_intended_x0020,
                intended_measurement_g=self.aind_burr_4_intended_x0021,
                intended_measurement_b=self.aind_burr_4_intended_x0022,
                intended_measurement_iso=self.aind_burr_4_intended_x0023,
                targeted_structure=self.aind_burr_4_intended,
                coordinate_system=coordinate_system,
            )
        elif burr_hole_num == 5:
            coordinate_depth = self._map_burr_hole_dv(
                self.aind_burr_5_d_v_x00,
                self.aind_burr_5_d_v_x000,
                self.aind_burr_5_d_v_x001,
            )
            injectable_materials = self._pair_burr_hole_inj_materials(
                materials=[
                    self.aind_burr_5_injectable_x0,
                    self.aind_burr_5_injectable_x00,
                    self.aind_burr_5_injectable_x01,
                    self.aind_burr_5_injectable_x02,
                ],
                titers=[
                    self.aind_burr_5_injectable_x03,
                    self.aind_burr_5_injectable_x04,
                    self.aind_burr_5_injectable_x05,
                    self.aind_burr_5_injectable_x06,
                ],
            )
            coordinate_system = (
                CoordinateSystemLibrary.BREGMA_ARID
                if coordinate_depth
                else CoordinateSystemLibrary.BREGMA_ARI
            )
            return BurrHoleInfo(
                hemisphere=self.aind_burr_5_hemisphere,
                coordinate_ml=self.aind_burr_5_m_l,
                coordinate_ap=self.aind_burr_5_a_p,
                coordinate_depth=coordinate_depth,
                angle=self.aind_burr_5_angle,
                during=self.aind_burr5_perform_during,
                inj_type=self.aind_inj5_type,
                virus_strain=self.aind_inj5_virus_strain_rt,
                inj_current=self.aind_inj5_current,
                alternating_current=self.aind_inj5_alternating_time,
                inj_duration=self.aind_inj5_ionto_time,
                inj_volume=self.aind_inj5volperdepth,
                inj_materials=injectable_materials,
                fiber_implant_depth=self.aind_fiber_implant5_d_x00,
                fiber_type=self.aind_burr_5_fiber_t,
                fiber_implant_length=self.aind_fiber_implant5_lengt,
                intended_measurement_r=self.aind_burr_5_intended_x0020,
                intended_measurement_g=self.aind_burr_5_intended_x0021,
                intended_measurement_b=self.aind_burr_5_intended_x0022,
                intended_measurement_iso=self.aind_burr_5_intended_x0023,
                targeted_structure=self.aind_burr_5_intended,
                coordinate_system=coordinate_system,
            )
        elif burr_hole_num == 6:
            coordinate_depth = self._map_burr_hole_dv(
                self.aind_burr_6_d_v_x00,
                self.aind_burr_6_d_v_x000,
                self.aind_burr_6_d_v_x001,
            )
            injectable_materials = self._pair_burr_hole_inj_materials(
                materials=[
                    self.aind_burr_6_injectable_x0,
                    self.aind_burr_6_injectable_x00,
                    self.aind_burr_6_injectable_x01,
                    self.aind_burr_6_injectable_x02,
                ],
                titers=[
                    self.aind_burr_6_injectable_x03,
                    self.aind_burr_6_injectable_x04,
                    self.aind_burr_6_injectable_x05,
                    self.aind_burr_6_injectable_x06,
                ],
            )
            coordinate_system = (
                CoordinateSystemLibrary.BREGMA_ARID
                if coordinate_depth
                else CoordinateSystemLibrary.BREGMA_ARI
            )
            return BurrHoleInfo(
                hemisphere=self.aind_burr_6_hemisphere,
                coordinate_ml=self.aind_burr_6_m_l,
                coordinate_ap=self.aind_burr_6_a_p,
                coordinate_depth=coordinate_depth,
                angle=self.aind_burr_6_angle,
                during=self.aind_burr6_perform_during,
                inj_type=self.aind_inj6_type,
                virus_strain=self.aind_inj6_virus_strain_rt,
                inj_current=self.aind_inj6_current,
                alternating_current=self.aind_inj6_alternating_time,
                inj_duration=self.aind_inj6_ionto_time,
                inj_volume=self.aind_inj6volperdepth,
                inj_materials=injectable_materials,
                fiber_implant_depth=self.aind_fiber_implant6_d_x00,
                fiber_type=self.aind_burr_6_fiber_t,
                fiber_implant_length=self.aind_fiber_implant6_lengt,
                intended_measurement_r=self.aind_burr_6_intended_x0020,
                intended_measurement_g=self.aind_burr_6_intended_x0021,
                intended_measurement_b=self.aind_burr_6_intended_x0022,
                intended_measurement_iso=self.aind_burr_6_intended_x0023,
                targeted_structure=self.aind_burr_6_intended,
                coordinate_system=coordinate_system,
            )
        else:
            return BurrHoleInfo()

    @staticmethod
    def _map_burr_hole_dv(dv1, dv2, dv3):
        """Maps dvs for a burr hole to one coordinate depth list"""
        if all(dv is None for dv in (dv1, dv2, dv3)):
            return None
        else:
            return [dv for dv in (dv1, dv2, dv3) if dv is not None]

    def map_burr_hole_injection_materials(
        self, injectable_materials: List[InjectableMaterial]
    ) -> Optional[List[Union[ViralMaterial, NonViralMaterial]]]:
        """Maps injection materials for burr hole."""
        injection_materials = []
        for injectable_material in injectable_materials:
            if (
                injectable_material.material
                and injectable_material.titer_str
                and self._is_titer(injectable_material.titer_str)
            ):
                titer = re.search(
                    self.SCIENTIFIC_NOTATION_REGEX,
                    injectable_material.titer_str,
                ).group(0)
                viral = ViralMaterial(
                    name=injectable_material.material,
                    titer=self._parse_titer_str(titer),
                )
                injection_materials.append(viral)
            elif (
                injectable_material.material
                and injectable_material.titer_str
                and self._is_concentration(injectable_material.titer_str)
            ):
                concentration = re.search(
                    self.CONCENTRATION_REGEX, injectable_material.titer_str
                ).group(1)
                # missing source info
                non_viral = NonViralMaterial.model_construct(
                    name=injectable_material.material,
                    concentration=self._parse_concentration_str(concentration),
                )
                injection_materials.append(non_viral)
        return injection_materials

    @staticmethod
    def _pair_burr_hole_inj_materials(
        materials: List[str], titers: List[str]
    ) -> Optional[List[InjectableMaterial]]:
        """Pairs materials and corresponding titers/concentrations."""
        injectable_materials = []
        for material, titer_str in zip(materials, titers):
            if titer_str:
                injectable_material = InjectableMaterial(
                    material=material, titer_str=titer_str
                )
            else:
                injectable_material = InjectableMaterial(material=material)
            injectable_materials.append(injectable_material)
        return injectable_materials

    def _map_burr_fiber_probe(self, burr_info: BurrHoleInfo) -> FiberProbe:
        """Constructs a fiber probe"""
        if burr_info.fiber_type == FiberType.STANDARD:
            # construct because fiber probe names are assigned at the end
            return FiberProbe.model_construct(
                manufacturer=Organization.NEUROPHOTOMETRICS,
                core_diameter=200,
                numerical_aperture=0.37,
                ferrule_material=FerruleMaterial.CERAMIC,
                total_length=burr_info.fiber_implant_length,
            )
        elif burr_info.fiber_type == FiberType.CUSTOM:
            # if custom, specs are stored in requestor comments
            return FiberProbe.model_construct(
                total_length=burr_info.fiber_implant_length,
                notes=self.aind_long_requestor_comments,
            )
        else:
            return FiberProbe.model_construct(
                total_length=burr_info.fiber_implant_length,
            )

    @staticmethod
    def assign_fiber_probe_names(procedures: List) -> None:
        """
        Iterates through list of procedures and assigns ordered names to
        FiberProbe objects within each ProbeImplant.
        """
        probes_with_coords = []
        for proc in procedures:
            if isinstance(proc, ProbeImplant):
                fiber_probe = getattr(proc, "implanted_device", None)
                if isinstance(fiber_probe, FiberProbe):
                    probe_config = getattr(proc, "device_config", None)
                    if isinstance(probe_config, ProbeConfig) and hasattr(
                        probe_config, "transform"
                    ):
                        t = probe_config.transform[0]
                        if (
                            isinstance(t, Translation)
                            and len(t.translation) >= 2
                        ):
                            ap = float(t.translation[0])
                            ml = float(t.translation[1])

                            probes_with_coords.append(
                                (proc, fiber_probe, probe_config, ap, ml)
                            )

        # Sort by AP descending, ML ascending
        sorted_probes = sorted(probes_with_coords, key=lambda x: (-x[3], x[4]))
        for idx, (proc, fiber_probe, probe_config, ap, ml) in enumerate(
            sorted_probes
        ):
            name = f"Fiber_{idx}"
            fiber_probe.name = name
            probe_config.device_name = name

        return None

    @staticmethod
    def _get_intended_measurements(
        sp_measurement_data: List[IntendedMeasurementandCoords],
    ) -> List[IntendedMeasurementInformation]:
        """
        Parses intended measurements from NSB data
        """
        """Assigns fiber name for intended measurement by coordinate info"""

        intended_measurments = []
        sorted_data = sorted(
            sp_measurement_data,
            key=lambda measurement: (
                -float(measurement.coordinate_ap),
                float(measurement.coordinate_ml),
            ),
        )
        for index, data in enumerate(sorted_data):
            intended_measurments.append(
                IntendedMeasurementInformation(
                    fiber_name=f"Fiber_{index}",
                    intended_measurement_R=data.intended_measurement_R,
                    intended_measurement_B=data.intended_measurement_B,
                    intended_measurement_G=data.intended_measurement_G,
                    intended_measurement_Iso=data.intended_measurement_Iso,
                )
            )
        return intended_measurments

    def get_intended_measurements(
        self,
    ) -> List[IntendedMeasurementInformation]:
        """Get a List of Intended Measurements"""

        all_intended_measurements = []
        initial_measurements = []
        followup_measurements = []
        for burr_hole_num in range(1, 7):
            if getattr(self, f"aind_burr_hole_{burr_hole_num}") in {
                BurrHoleProcedure.INJECTION_FIBER_IMPLANT,
                BurrHoleProcedure.FIBER_IMPLANT,
            }:
                burr = self.burr_hole_info(burr_hole_num=burr_hole_num)
                if burr.during == During.INITIAL:
                    initial_measurements.append(
                        IntendedMeasurementandCoords(
                            intended_measurement_R=burr.intended_measurement_r,
                            intended_measurement_B=burr.intended_measurement_b,
                            intended_measurement_G=burr.intended_measurement_g,
                            intended_measurement_Iso=(
                                burr.intended_measurement_iso
                            ),
                            coordinate_ap=burr.coordinate_ap,
                            coordinate_ml=burr.coordinate_ml,
                        )
                    )
                elif burr.during == During.FOLLOW_UP:
                    followup_measurements.append(
                        IntendedMeasurementandCoords(
                            intended_measurement_R=burr.intended_measurement_r,
                            intended_measurement_B=burr.intended_measurement_b,
                            intended_measurement_G=burr.intended_measurement_g,
                            intended_measurement_Iso=(
                                burr.intended_measurement_iso
                            ),
                            coordinate_ap=burr.coordinate_ap,
                            coordinate_ml=burr.coordinate_ml,
                        )
                    )
                else:
                    # skip fiber name assignment if no During info
                    all_intended_measurements.append(
                        IntendedMeasurementInformation(
                            intended_measurement_R=burr.intended_measurement_r,
                            intended_measurement_B=burr.intended_measurement_b,
                            intended_measurement_G=burr.intended_measurement_g,
                            intended_measurement_Iso=(
                                burr.intended_measurement_iso
                            ),
                        )
                    )
        all_intended_measurements.extend(
            self._get_intended_measurements(initial_measurements)
        )
        all_intended_measurements.extend(
            self._get_intended_measurements(followup_measurements)
        )
        return all_intended_measurements

    @staticmethod
    def map_measured_coordinates(
        b2l_dist: Optional[Decimal],
        surgery_coordinate_system: Optional[CoordinateSystem],
    ) -> Optional[Dict[Origin, Translation]]:
        """
        Maps measured coordinates using the surgery's coordinate system.
        Parameters
        ----------
        b2l_dist: Optional[Decimal]
            The distance from bregma to lambda.
        surgery_coordinate_system: Optional[CoordinateSystem]
            The coordinate system object for the surgery.
        Returns
        -------
            Optional[Dict[Origin, Translation]]
        """
        if b2l_dist is None or surgery_coordinate_system is None:
            return None

        name = surgery_coordinate_system.name
        if name.startswith("LAMBDA"):
            origin = Origin.BREGMA
            dist = b2l_dist
            return {origin: Translation(translation=[dist, 0, 0])}
        elif name.startswith("BREGMA"):
            origin = Origin.LAMBDA
            dist = -(abs(b2l_dist))
            return {origin: Translation(translation=[dist, 0, 0])}
        else:
            return None

    def determine_surgery_coordinate_system(
        self, during: During
    ) -> Optional[CoordinateSystem]:
        """
        Determines the dominant coordinate system for a surgery by inspecting
        the relevant surgery information.
        Parameters
        ----------
        during: During
            The phase of the surgery (initial, followup).
        Returns
        -------
            Optional[CoordinateSystem]
        """
        systems = []
        spinal_origins = []

        # Craniotomy
        if (
            self.has_cran_procedure()
            and self.aind_craniotomy_perform_d == during
        ):
            ref = self.aind_craniotomy_coordinates_reference
            if ref:
                systems.append(ref)

        # Burr holes
        for i in range(1, 7):
            burr_info = self.burr_hole_info(i)
            if burr_info.during == during:
                burr_hole_type = getattr(self, f"aind_burr_hole_{i}")
                if (
                    burr_hole_type == BurrHoleProcedure.SPINAL_INJECTION
                    and burr_info.spinal_location
                ):
                    spinal_origins.append(burr_info.spinal_location)
                elif burr_info.coordinate_system:
                    systems.append(burr_info.coordinate_system)

        # If we have spinal injections, create spinal coordinate system
        if spinal_origins:
            spinal_origin = spinal_origins[0]
            return CoordinateSystem(
                name=self._get_spinal_coordinate_system_name(spinal_origin),
                origin=spinal_origin,
                axis_unit=SizeUnit.MM,
                axes=[
                    Axis(name=AxisName.AP, direction=Direction.PA),
                    Axis(name=AxisName.ML, direction=Direction.LR),
                    Axis(name=AxisName.SI, direction=Direction.SI),
                ],
            )

        # Prioritize ARID over ARI, and LAMBDA over BREGMA if all are lambda
        names = [s.name for s in systems if s]
        if any(n.endswith("ARID") for n in names):
            return CoordinateSystemLibrary.BREGMA_ARID
        elif any(n.endswith("ARI") for n in names):
            if all(n.startswith("LAMBDA") for n in names):
                return CoordinateSystem(
                    name="LAMBDA_ARI",
                    origin=Origin.LAMBDA,
                    axis_unit=SizeUnit.MM,
                    axes=[
                        Axis(name=AxisName.AP, direction=Direction.PA),
                        Axis(name=AxisName.ML, direction=Direction.LR),
                        Axis(name=AxisName.SI, direction=Direction.SI),
                    ],
                )
            return CoordinateSystemLibrary.BREGMA_ARI

        return None

    @staticmethod
    def _map_burr_hole_transforms(
        angle: Optional[Decimal],
        ml: Optional[Decimal],
        ap: Optional[Decimal],
        depth: Optional[Union[Decimal, List[Decimal]]],
        surgery_coordinate_system: Optional[CoordinateSystem] = None,
    ) -> List[List[Union[Translation, Rotation]]]:
        """
        Maps transforms (translations and rotations) for a burr hole.
        Parameters
        ----------
        angle: Optional[Decimal]
            The angle of rotation.
        ml: Optional[Decimal]
            The mediolateral position.
        ap: Optional[Decimal]
            The anteroposterior position.
        depth: Optional[Union[Decimal, List[Decimal]]]
            The depth of the burr hole.
        surgery_coordinate_system: Optional[CoordinateSystem]
            The coordinate system for the surgery.
        Returns
        -------
        List[List[Union[Translation, Rotation]]]
        """
        ap = ap if ap is not None else 0
        ml = ml if ml is not None else 0
        angle = angle if angle is not None else 0
        is_arid = (
            surgery_coordinate_system is not None
            and surgery_coordinate_system.name.endswith("ARID")
        )

        transforms = []
        if depth is None:
            translation = Translation(translation=[ap, ml, 0])
            rotation = Rotation(
                angles=[angle, 0, 0], angles_unit=AngleUnit.DEG
            )
            if is_arid:
                translation.translation.append(0)
                rotation.angles.append(0)
            transforms.append([translation, rotation])
        else:
            for d in depth:
                translation = Translation(
                    translation=[ap, ml, 0, d] if is_arid else [ap, ml, 0]
                )
                rotation = Rotation(
                    angles=[angle, 0, 0, 0] if is_arid else [angle, 0, 0],
                    angles_unit=AngleUnit.DEG,
                )
                transforms.append([translation, rotation])
        return transforms

    @staticmethod
    def _map_anaesthetic(
        duration: Optional[Decimal], level: Optional[Decimal]
    ) -> Anaesthetic:
        """Maps anaesthetic information."""
        try:
            return Anaesthetic(
                anaesthetic_type="isoflurane",
                duration=duration,
                level=level,
            )
        except ValidationError:
            return Anaesthetic.model_construct(
                anaesthetic_type="isoflurane",
                duration=duration,
                level=level,
            )

    def get_surgeries(self) -> List[Surgery]:
        """Get a List of Surgeries."""

        surgeries = []

        # Surgery info
        initial_start_date = self.aind_date_of_surgery
        initial_animal_weight_prior = self.aind_weight_before_surger
        initial_animal_weight_post = self.aind_weight_after_surgery
        initial_surgeon = self.aind_experimenter_full_name(
            self.aind_initial_surgeon_lookup_id
        )

        followup_start_date = self.aind_date1st_injection
        followup_animal_weight_prior = self.aind_first_injection_weight_be
        followup_animal_weight_post = self.aind_first_injection_weight_af
        followup_surgeon = self.aind_experimenter_full_name(
            self.aind_followup_surgeon_lookup_id
        )

        iacuc_protocol = (
            self.aind_iacuc_protocol
            if self.aind_iacuc_protocol
            else self.aind_protocol
        )

        notes = None
        initial_anaesthesia = None
        followup_anaesthesia = None
        initial_workstation_id = None
        followup_workstation_id = None

        initial_procedures = []
        followup_procedures = []
        other_procedures = []

        # --- 1. Determine coordinate system for each surgery ---
        initial_coord_system = self.determine_surgery_coordinate_system(
            During.INITIAL
        )
        followup_coord_system = self.determine_surgery_coordinate_system(
            During.FOLLOW_UP
        )

        # --- 2. Build procedures for initial surgery ---
        if self.has_hp_procedure():
            hp_during = self.aind_headpost_perform_dur
            hf_surgery_during_info = self.surgery_during_info(hp_during)
            headpost_info = HeadPostInfo.from_hp_and_hp_type(
                hp=self.aind_headpost, hp_type=self.aind_headpost_type
            )
            try:
                headframe_procedure = Headframe(
                    headframe_type=headpost_info.headframe_type,
                    headframe_part_number=headpost_info.headframe_part_number,
                    headframe_material=headpost_info.headframe_material,
                    well_type=headpost_info.well_type,
                    well_part_number=headpost_info.well_part_number,
                )
            except ValidationError:
                headframe_procedure = Headframe.model_construct(
                    headframe_type=headpost_info.headframe_type,
                    headframe_part_number=headpost_info.headframe_part_number,
                    headframe_material=headpost_info.headframe_material,
                    well_type=headpost_info.well_type,
                    well_part_number=headpost_info.well_part_number,
                )
            anaesthesia = self._map_anaesthetic(
                hf_surgery_during_info.anaesthetic_duration_in_minutes,
                hf_surgery_during_info.anaesthetic_level,
            )

            if hp_during == During.INITIAL:
                initial_anaesthesia = anaesthesia
                initial_workstation_id = self.aind_hp_work_station
                initial_procedures.append(headframe_procedure)
            elif hp_during == During.FOLLOW_UP:
                followup_anaesthesia = anaesthesia
                followup_workstation_id = self.aind_hp_work_station
                followup_procedures.append(headframe_procedure)
            else:
                other_procedures.append(headframe_procedure)

        if self.has_cran_procedure():
            cran_during = self.aind_craniotomy_perform_d
            cran_surgery_during_info = self.surgery_during_info(cran_during)
            implant_part_number = self.aind_implant_id_coverslip_type
            headpost_info = HeadPostInfo.from_hp_and_hp_type(
                hp=self.aind_headpost, hp_type=self.aind_headpost_type
            )
            coordinate_system_name = (
                initial_coord_system.name
                if cran_during == During.INITIAL and initial_coord_system
                else (
                    followup_coord_system.name
                    if cran_during == During.FOLLOW_UP
                    and followup_coord_system
                    else None
                )
            )
            try:
                cran_procedure = Craniotomy(
                    craniotomy_type=self.aind_craniotomy_type,
                    size=self.aind_craniotomy_size,
                    size_unit=(
                        SizeUnit.MM if self.aind_craniotomy_size else None
                    ),
                    coordinate_system_name=coordinate_system_name,
                    implant_part_number=implant_part_number,
                    position=self.aind_craniotomy_coordinates,
                )
                headframe_procedure = Headframe(
                    headframe_type=headpost_info.headframe_type,
                    headframe_part_number=headpost_info.headframe_part_number,
                    headframe_material=headpost_info.headframe_material,
                    well_type=headpost_info.well_type,
                    well_part_number=headpost_info.well_part_number,
                )
            except ValidationError:
                cran_procedure = Craniotomy.model_construct(
                    craniotomy_type=self.aind_craniotomy_type,
                    size=self.aind_craniotomy_size,
                    size_unit=(
                        SizeUnit.MM if self.aind_craniotomy_size else None
                    ),
                    coordinate_system_name=coordinate_system_name,
                    implant_part_number=implant_part_number,
                    position=self.aind_craniotomy_coordinates,
                )
                headframe_procedure = Headframe.model_construct(
                    headframe_type=headpost_info.headframe_type,
                    headframe_part_number=headpost_info.headframe_part_number,
                    headframe_material=headpost_info.headframe_material,
                    well_type=headpost_info.well_type,
                    well_part_number=headpost_info.well_part_number,
                )
            anaesthesia = self._map_anaesthetic(
                cran_surgery_during_info.anaesthetic_duration_in_minutes,
                cran_surgery_during_info.anaesthetic_level,
            )
            if cran_during == During.INITIAL:
                initial_anaesthesia = anaesthesia
                initial_workstation_id = self.aind_hp_work_station
                initial_procedures.append(cran_procedure)
                initial_procedures.append(headframe_procedure)
            elif cran_during == During.FOLLOW_UP:
                followup_anaesthesia = anaesthesia
                followup_workstation_id = self.aind_hp_work_station
                followup_procedures.append(cran_procedure)
                followup_procedures.append(headframe_procedure)
            else:
                other_procedures.append(cran_procedure)
                other_procedures.append(headframe_procedure)

        # --- 3. Burr holes ---
        for burr_hole_num in range(1, 7):
            burr_hole_type = getattr(self, f"aind_burr_hole_{burr_hole_num}")
            burr_hole_info = self.burr_hole_info(burr_hole_num)
            burr_during_info = self.surgery_during_info(
                during=burr_hole_info.during,
            )
            anaesthesia = self._map_anaesthetic(
                burr_during_info.anaesthetic_duration_in_minutes,
                burr_during_info.anaesthetic_level,
            )
            # Use correct coordinate system for transforms
            if burr_hole_info.during == During.INITIAL:
                surgery_coord_system = initial_coord_system
            elif burr_hole_info.during == During.FOLLOW_UP:
                surgery_coord_system = followup_coord_system
            else:
                surgery_coord_system = None

            # Only build if procedure type is injection or fiber implant
            if burr_hole_type in {
                BurrHoleProcedure.INJECTION,
                BurrHoleProcedure.INJECTION_FIBER_IMPLANT,
                BurrHoleProcedure.SPINAL_INJECTION,
            }:
                transforms = (
                    self._map_burr_hole_transforms(
                        angle=burr_hole_info.angle,
                        ml=burr_hole_info.coordinate_ml,
                        ap=burr_hole_info.coordinate_ap,
                        depth=burr_hole_info.coordinate_depth,
                        surgery_coordinate_system=surgery_coord_system,
                    )
                    if surgery_coord_system
                    else burr_hole_info.transforms
                )

                injection_materials = self.map_burr_hole_injection_materials(
                    burr_hole_info.inj_materials
                )
                dynamics = []
                if burr_hole_info.inj_type == InjectionType.IONTOPHORESIS:
                    try:
                        dynamics_obj = InjectionDynamics(
                            profile=InjectionProfile.BOLUS,
                            duration=burr_hole_info.inj_duration,
                            injection_current=burr_hole_info.inj_current,
                            injection_current_unit=(
                                CurrentUnit.UA
                                if burr_hole_info.inj_current
                                else None
                            ),
                            alternating_current=(
                                burr_hole_info.alternating_current
                            ),
                        )
                    except ValidationError:
                        dynamics_obj = InjectionDynamics.model_construct(
                            profile=InjectionProfile.BOLUS,
                            duration=burr_hole_info.inj_duration,
                            injection_current=burr_hole_info.inj_current,
                            injection_current_unit=(
                                CurrentUnit.UA
                                if burr_hole_info.inj_current
                                else None
                            ),
                            alternating_current=(
                                burr_hole_info.alternating_current
                            ),
                        )
                    dynamics = (
                        [dynamics_obj] * len(transforms)
                        if transforms
                        else [dynamics_obj]
                    )
                elif burr_hole_info.inj_type == InjectionType.NANOJECT:
                    try:
                        dynamics_obj = InjectionDynamics(
                            profile=InjectionProfile.BOLUS,
                            duration=burr_hole_info.inj_duration,
                            volume=burr_hole_info.inj_volume,
                            volume_unit=VolumeUnit.NL,
                        )
                    except ValidationError:
                        dynamics_obj = InjectionDynamics.model_construct(
                            profile=InjectionProfile.BOLUS,
                            duration=burr_hole_info.inj_duration,
                            volume=burr_hole_info.inj_volume,
                            volume_unit=VolumeUnit.NL,
                        )
                    dynamics = (
                        [dynamics_obj] * len(transforms)
                        if transforms
                        else [dynamics_obj]
                    )
                try:
                    injection_proc = BrainInjection(
                        injection_materials=injection_materials,
                        targeted_structure=(
                            burr_hole_info.targeted_structure[0]
                            if burr_hole_info.targeted_structure
                            else None
                        ),
                        relative_position=[burr_hole_info.hemisphere],
                        dynamics=dynamics,
                        coordinate_system_name=(
                            surgery_coord_system.name
                            if surgery_coord_system
                            else None
                        ),
                        coordinates=transforms,
                    )
                except ValidationError:
                    injection_proc = BrainInjection.model_construct(
                        injection_materials=injection_materials,
                        targeted_structure=(
                            burr_hole_info.targeted_structure[0]
                            if burr_hole_info.targeted_structure
                            else None
                        ),
                        relative_position=[burr_hole_info.hemisphere],
                        dynamics=dynamics,
                        coordinate_system_name=(
                            surgery_coord_system.name
                            if surgery_coord_system
                            else None
                        ),
                        coordinates=transforms,
                    )
                if burr_hole_info.during == During.INITIAL:
                    initial_anaesthesia = anaesthesia
                    initial_workstation_id = burr_during_info.workstation_id
                    initial_procedures.append(injection_proc)
                elif burr_hole_info.during == During.FOLLOW_UP:
                    followup_anaesthesia = anaesthesia
                    followup_workstation_id = burr_during_info.workstation_id
                    followup_procedures.append(injection_proc)
                else:
                    other_procedures.append(injection_proc)

            if burr_hole_type in {
                BurrHoleProcedure.FIBER_IMPLANT,
                BurrHoleProcedure.INJECTION_FIBER_IMPLANT,
            }:
                fiber_probe = self._map_burr_fiber_probe(burr_hole_info)
                primary_target = None
                other_targets = []

                if (
                    burr_hole_info.targeted_structure
                    and len(burr_hole_info.targeted_structure) > 0
                ):
                    primary_target = burr_hole_info.targeted_structure[0]
                    if len(burr_hole_info.targeted_structure) > 1:
                        other_targets = burr_hole_info.targeted_structure[1:]

                coordinate_system = CoordinateSystem(
                    name="FIBER_PROBE_RSAB",
                    origin=Origin.TIP,
                    axis_unit=SizeUnit.MM,
                    axes=[
                        Axis(name=AxisName.X, direction=Direction.LR),
                        Axis(name=AxisName.Y, direction=Direction.IS),
                        Axis(name=AxisName.Z, direction=Direction.PA),
                        Axis(name=AxisName.DEPTH, direction=Direction.UD),
                    ],
                )
                transforms = self._map_burr_hole_transforms(
                    angle=burr_hole_info.angle,
                    ml=burr_hole_info.coordinate_ml,
                    ap=burr_hole_info.coordinate_ap,
                    depth=burr_hole_info.coordinate_depth,
                )
                probe_implant_proc = ProbeImplant.model_construct(
                    implanted_device=fiber_probe,
                    device_config=ProbeConfig.model_construct(
                        primary_targeted_structure=primary_target,
                        other_targeted_structure=other_targets,
                        device_name=None,
                        coordinate_system=coordinate_system,
                        transform=transforms[0],
                    ),
                )
                if burr_hole_info.during == During.INITIAL:
                    initial_anaesthesia = anaesthesia
                    initial_workstation_id = burr_during_info.workstation_id
                    initial_procedures.append(probe_implant_proc)
                elif burr_hole_info.during == During.FOLLOW_UP:
                    followup_anaesthesia = anaesthesia
                    followup_workstation_id = burr_during_info.workstation_id
                    followup_procedures.append(probe_implant_proc)
                else:
                    other_procedures.append(probe_implant_proc)

        # --- 4. Surgery objects ---
        if initial_procedures:
            self.assign_fiber_probe_names(initial_procedures)
            measured_coordinates = self.map_measured_coordinates(
                self.aind_breg2_lamb, initial_coord_system
            )
            try:
                initial_surgery = Surgery(
                    start_date=initial_start_date,
                    experimenters=[initial_surgeon],
                    ethics_review_id=iacuc_protocol,
                    animal_weight_prior=initial_animal_weight_prior,
                    animal_weight_post=initial_animal_weight_post,
                    anaesthesia=initial_anaesthesia,
                    workstation_id=initial_workstation_id,
                    notes=notes,
                    procedures=initial_procedures,
                    measured_coordinates=measured_coordinates,
                    coordinate_system=initial_coord_system,
                )
            except (ValidationError, TypeError):
                initial_surgery = Surgery.model_construct(
                    start_date=initial_start_date,
                    experimenters=[initial_surgeon],
                    ethics_review_id=iacuc_protocol,
                    animal_weight_prior=initial_animal_weight_prior,
                    animal_weight_post=initial_animal_weight_post,
                    anaesthesia=initial_anaesthesia,
                    workstation_id=initial_workstation_id,
                    notes=notes,
                    procedures=initial_procedures,
                    measured_coordinates=measured_coordinates,
                    coordinate_system=initial_coord_system,
                )
            surgeries.append(initial_surgery)

        if followup_procedures:
            self.assign_fiber_probe_names(followup_procedures)
            measured_coordinates = self.map_measured_coordinates(
                self.aind_breg2_lamb, followup_coord_system
            )
            try:
                followup_surgery = Surgery(
                    start_date=followup_start_date,
                    experimenters=[followup_surgeon],
                    ethics_review_id=iacuc_protocol,
                    animal_weight_prior=followup_animal_weight_prior,
                    animal_weight_post=followup_animal_weight_post,
                    anaesthesia=followup_anaesthesia,
                    workstation_id=followup_workstation_id,
                    notes=notes,
                    procedures=followup_procedures,
                    measured_coordinates=measured_coordinates,
                    coordinate_system=followup_coord_system,
                )
            except ValidationError:
                followup_surgery = Surgery.model_construct(
                    start_date=followup_start_date,
                    experimenters=[followup_surgeon],
                    ethics_review_id=iacuc_protocol,
                    animal_weight_prior=followup_animal_weight_prior,
                    animal_weight_post=followup_animal_weight_post,
                    anaesthesia=followup_anaesthesia,
                    workstation_id=followup_workstation_id,
                    notes=notes,
                    procedures=followup_procedures,
                    measured_coordinates=measured_coordinates,
                    coordinate_system=followup_coord_system,
                )
            surgeries.append(followup_surgery)

        if other_procedures:
            self.assign_fiber_probe_names(other_procedures)
            measured_coordinates = self.map_measured_coordinates(
                self.aind_breg2_lamb, CoordinateSystemLibrary.BREGMA_ARID
            )
            other_surgery = Surgery.model_construct(
                start_date=None,
                experimenters=["NSB"],
                ethics_review_id=iacuc_protocol,
                animal_weight_prior=None,
                animal_weight_post=None,
                anaesthesia=None,
                workstation_id=None,
                notes=notes,
                procedures=other_procedures,
                measured_coordinates=measured_coordinates,
            )
            surgeries.append(other_surgery)
        return surgeries
